<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="设计模式, ShapeFanBlog">
    <meta name="description" content="设计模式概述
设计模式一般包含模式名称、问题、目的、解决方案、效果等组成要素，其中关键要素是模 式名称、问题、解决方案和效果。

GoF设计模式有23个 + 简单工厂模式

学习点

设计模式的意图

解决什么问题，什么时候使用该设计模式
">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>设计模式 | ShapeFanBlog</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">
    
    <script src="/libs/jquery/jquery.min.js"></script>
    
<meta name="generator" content="Hexo 4.2.0"><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper head-container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">ShapeFanBlog</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>

<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">ShapeFanBlog</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			Contact
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/shapefire" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>

        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/shapefire" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/17.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">设计模式</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        height: calc(100vh - 250px);
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #toc-content .is-active-link::before {
        background-color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">
                                <span class="chip bg-color">设计模式</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" class="post-category">
                                设计模式
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2020-03-02
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2020-06-15
                </div>
                
                <!--添加作者信息-->
                  <div class="info-break-policy">
                    
                        <i class="fa fa-pencil"></i> 作者: ShapeFire
                    
                </div>
                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    20.5k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    80 分
                </div>
                

                
            </div>

        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="设计模式"><a href="#设计模式" class="headerlink" title="设计模式"></a>设计模式</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><ul>
<li><p>设计模式一般包含模式名称、问题、目的、解决方案、效果等组成要素，其中关键要素是模 式名称、问题、解决方案和效果。</p>
</li>
<li><p>GoF设计模式有23个 + 简单工厂模式</p>
</li>
<li><p>学习点</p>
<ul>
<li><p>设计模式的意图</p>
</li>
<li><p>解决什么问题，什么时候使用该设计模式</p>
</li>
<li><p>怎样解决</p>
</li>
<li><p>结构图</p>
</li>
<li><p>关键代码</p>
</li>
<li><p>应用实例</p>
<ul>
<li>生活中：</li>
<li>软件中：</li>
</ul>
</li>
<li><p>优点</p>
</li>
<li><p>缺点</p>
</li>
<li><p>注意事项</p>
</li>
</ul>
</li>
</ul>
<h2 id="面向对象原则"><a href="#面向对象原则" class="headerlink" title="面向对象原则"></a>面向对象原则</h2><h3 id="7种常用的面向对象原则："><a href="#7种常用的面向对象原则：" class="headerlink" title="7种常用的面向对象原则："></a>7种常用的面向对象原则：</h3><ol>
<li><p>单一职责原则(Single    Responsibility Principle,    SRP)一个类只负责一个功能领域中的相应职责 ★★★★☆</p>
</li>
<li><p>开闭原则    (Open-Closed    Principle,    OCP) 软件实体应对扩展开放，而对修改关闭 ★★★★★</p>
</li>
<li><p>里氏代换原则    (Liskov    Substitution Principle,    LSP) 所有引用基类对象的地方能够透明地使用 其子类的对象 ★★★★★</p>
</li>
<li><p>依赖倒转原则    (Dependence    Inversion Principle,    DIP) 抽象不应该依赖于细节，细节应该依赖于 抽象 ★★★★★ </p>
</li>
<li><p>接口隔离原则    (Interface    Segregation Principle,    ISP) 使用多个专门的接口，而不使用单一的总 接口 ★★☆☆☆ </p>
</li>
<li><p>合成复用原则    (Composite    Reuse Principle,    CRP) 尽量使用对象组合，而不是继承来达到复 用的目的 ★★★★☆ </p>
</li>
<li><p>迪米特法则    (Law    of    Demeter,    LoD) 一个软件实体应当尽可能少地与其他实体 发生相互作用 ★★★☆☆</p>
</li>
</ol>
<h2 id="六个创建型模式"><a href="#六个创建型模式" class="headerlink" title="六个创建型模式"></a>六个创建型模式</h2><h3 id="简单工厂模式："><a href="#简单工厂模式：" class="headerlink" title="简单工厂模式："></a>简单工厂模式：</h3><p>​              简单工厂模式的要点在于：当你需要什么，只<strong>需要传入一个正确的参数</strong>，就可以获取你所需要的对象，而<strong>无须知道其创建细节</strong>。其<strong>核心是工厂类的设计</strong></p>
<ul>
<li><p>设计模式的意图:</p>
</li>
<li><p><strong>对简单工厂模式的意图,利用* .properties等属性文件进行类的对应工作.实现无须重新编译代码.即可完成工厂类的选择生成具体类的工作,减少了工厂类与具体需要生成类的耦合性.</strong></p>
</li>
<li><p>解决什么问题，什么时候使用该设计模式</p>
<ul>
<li>解决只能通过new关键字创建对象，降低与客户端类的耦合度；是对象的创建与对象的使用分离（不分离—》可能违反开闭原则）；降低该类对象创建时的代码重复；提高对象创建的效率；</li>
</ul>
</li>
<li><p>怎样解决</p>
<ul>
<li>将需要创建的各种不同对象（例如各种不同的Chart对象）的相关代码封装到不同的类 中，这些类称为<strong>具体产品类</strong>，而将它们公共的代码进行抽象和提取后封装在一个<strong>抽象产品类</strong> 中，每一个<strong>具体产品类都是抽象产品类的子类</strong>；然后<strong>提供一个工厂类用于创建各种产品</strong>，在 工厂类中提供一个创建产品的工厂方法，该方法可以<strong>根据所传入的参数不同创建不同的具体 产品对象</strong>；<strong>客户端</strong>只需<strong>调用工厂类的工厂方法并传入相应的参数</strong>即可得到一个产品对象</li>
</ul>
</li>
<li><p>结构图</p>
<ul>
<li><img src="https://shapefire.github.io/posts/911124684/simpleFactoryConstructionImg.PNG" alt="simpleFactoryConstruction"></li>
</ul>
</li>
<li><p>Factory（工厂角色）：工厂角色即工厂类，它是简单工厂模式的核心，负责实现创建所有产 品实例的内部逻辑；工厂类可以被外界直接调用，创建所需的产品对象；在工厂类中提供了静态的工厂方法factoryMethod()，它的返回类型为抽象产品类型Product。</p>
</li>
<li><p>Product（抽象产品角色）：它是工厂类所创建的所有对象的父类，封装了各种产品对象的 公有方法，它的引入将提高系统的灵活性，使得在工厂类中只需定义一个通用的工厂方法， 因为所有创建的具体产品对象都是其子类对象。</p>
</li>
<li><p>ConcreteProduct（具体产品角色）：它是简单工厂模式的创建目标，所有被创建的对象都充 当这个角色的某个具体类的实例。每一个具体产品角色都继承了抽象产品角色，需要实现在 抽象产品中声明的抽象方法。</p>
</li>
<li><p>关键代码</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">abstract</span> <span class="token keyword">class</span>    <span class="token class-name">Product</span>    <span class="token punctuation">{</span>    
<span class="token comment" spellcheck="true">//所有产品类的公共业务方法                        </span>
    <span class="token keyword">public</span>    <span class="token keyword">void</span>    <span class="token function">methodSame</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>    
    <span class="token comment" spellcheck="true">//公共方法的实现                        </span>
    <span class="token punctuation">}</span>        
    <span class="token comment" spellcheck="true">//声明抽象业务方法    </span>
    <span class="token keyword">public</span>    <span class="token keyword">abstract</span> <span class="token keyword">void</span>    <span class="token function">methodDiff</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        
 <span class="token punctuation">}</span>

在具体产品类中实现了抽象产品类中声明的抽象业务方法，不同的具体产品类可以提供不同 的实现，典型的具体产品类代码如下所示：
<span class="token keyword">class</span>    <span class="token class-name">ConcreteProduct</span>    <span class="token keyword">extends</span>    <span class="token class-name">Product</span>    <span class="token punctuation">{</span>                        
<span class="token comment" spellcheck="true">//实现业务方法                        </span>
    <span class="token keyword">public</span>    <span class="token keyword">void</span>    <span class="token function">methodDiff</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>                                    
<span class="token comment" spellcheck="true">//业务方法的实现                        </span>
    <span class="token punctuation">}</span>        
<span class="token punctuation">}</span>

<span class="token keyword">class</span>    <span class="token class-name">Factory</span>    <span class="token punctuation">{</span>
<span class="token comment" spellcheck="true">//静态工厂方法                        </span>
    <span class="token keyword">public</span>    <span class="token keyword">static</span>    Product    <span class="token function">getProduct</span><span class="token punctuation">(</span>String    arg<span class="token punctuation">)</span>    <span class="token punctuation">{</span>                        Product    product    <span class="token operator">=</span>    null<span class="token punctuation">;</span>                                        
        <span class="token keyword">if</span><span class="token punctuation">(</span>arg<span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>                                                    product    <span class="token operator">=</span>    <span class="token keyword">new</span>    <span class="token class-name">ConcreteProductA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token comment" spellcheck="true">//初始化设置product    </span>
          <span class="token punctuation">}</span>    <span class="token keyword">else</span> <span class="token keyword">if</span>    <span class="token punctuation">(</span>arg<span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span><span class="token string">"B"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>                                                        product    <span class="token operator">=</span>    <span class="token keyword">new</span>    <span class="token class-name">ConcreteProductB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                    
        <span class="token punctuation">}</span>                                    
        <span class="token keyword">return</span>    product<span class="token punctuation">;</span>                        
        <span class="token punctuation">}</span>        
 <span class="token punctuation">}</span>

 在客户端代码中，我们通过调用工厂类的工厂方法即可得到产品对象，典型代码如下所示：
<span class="token keyword">class</span>    <span class="token class-name">Client</span>    <span class="token punctuation">{</span>                    
    <span class="token keyword">public</span>    <span class="token keyword">static</span>    <span class="token keyword">void</span>    <span class="token function">main</span><span class="token punctuation">(</span>String    args<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>                                Product    product<span class="token punctuation">;</span>                                    
        product    <span class="token operator">=</span>    Factory<span class="token punctuation">.</span><span class="token function">getProduct</span><span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//通过工厂类创建产品对象                        product.methodSame();        </span>
        product<span class="token punctuation">.</span><span class="token function">methodDiff</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        
        <span class="token punctuation">}</span>    
  <span class="token punctuation">}</span></code></pre>
</li>
<li><p>简化简单工厂模式：将<strong>抽象产品类和工厂类合并</strong>，将静态工厂方法移至抽象产品类中</p>
</li>
</ul>
<ul>
<li><p>应用场景</p>
</li>
<li><p>优点</p>
<ul>
<li>工厂类包含必要的判断逻辑，可以决定在什么时候创建哪一个产品类的实例，客户端可以 免除直接创建产品对象的职责，而仅仅“消费”产品，简单工厂模式实现了对象创建和使用的分 离</li>
<li>客户端无须知道所创建的具体产品类的类名，只需要知道具体产品类所对应的参数即可， 对于一些复杂的类名，通过简单工厂模式可以在一定程度减少使用者的记忆量。</li>
<li>通过引入配置文件，可以在不修改任何客户端代码的情况下更换和增加新的具体产品类， 在一定程度上提高了系统的灵活性</li>
</ul>
</li>
<li><p>缺点</p>
<ul>
<li>由于工厂类集中了所有产品的创建逻辑，职责过重，一旦不能正常工作，整个系统都要受 到影响。</li>
<li>使用简单工厂模式势必会增加系统中类的个数（引入了新的工厂类），增加了系统的复杂 度和理解难度。</li>
<li>系统扩展困难（不灵活），一旦添加新产品就不得不修改工厂逻辑，在产品类型较多时，有可能造成 工厂逻辑过于复杂，不利于系统的扩展和维护。</li>
<li>简单工厂模式由于使用了静态工厂方法，造成工厂角色无法形成基于继承的等级结构</li>
<li><strong>最大缺点：</strong>当有新产品要加入到系统中时，必须修改工厂类，需要在其中加入必要的业务逻辑， 这违背了“开闭原则”。 ————》<strong>工厂方法模式解决</strong></li>
</ul>
</li>
<li><p>注意事项</p>
<ul>
<li>在以下情况下可以考虑使用简单工厂模式：<br>(1)<strong>工厂类负责创建的对象比较少</strong>，由于创建的对象较少，不会造成工厂方法中的业务逻辑太 过复杂。<br>(2)客户端<strong>只知道传入工厂类的参数</strong>，对于如何创建对象并不关心。</li>
</ul>
</li>
</ul>
<ul>
<li><p>练习：使用简单工厂模式设计一个可以创建不同几何形状（如圆形、方形和三角形等）的绘图 工具，每个几何图形都具有绘制draw()和擦除erase()两个方法，要求在绘制不支持的几何 图形时，提示一个UnSupportedShapeException。</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">DrawShape</span><span class="token punctuation">{</span>
      <span class="token keyword">void</span> <span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">void</span> <span class="token function">erase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>

 <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DrawCircle</span> <span class="token keyword">implements</span> <span class="token class-name">DrawShape</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token function">DrawCircle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// TODO Auto-generated constructor stub</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// TODO Auto-generated method stub</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"绘制圆"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">erase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// TODO Auto-generated method stub</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"擦除圆"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DrawRectangle</span> <span class="token keyword">implements</span> <span class="token class-name">DrawShape</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// TODO Auto-generated method stub</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"绘制矩形"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">erase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// TODO Auto-generated method stub</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"擦除矩形"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//没有异常处理的ShapeFactory类</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ShapeFactory</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> DrawShape <span class="token function">getShape</span><span class="token punctuation">(</span>String shapeName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        DrawShape drawShape <span class="token operator">=</span> null<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>shapeName<span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span><span class="token string">"circle"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            drawShape <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DrawCircle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>shapeName<span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span><span class="token string">"rectangle"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            drawShape <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DrawRectangle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> drawShape<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">/*这两个类可替代上面的没有异常处理的ShapeFactory类
//有UnSupportedShapeException异常处理的ShapeFactory类
public class ShapeFactory {
    public static DrawShape getShape(String shapeName) throws UnSupportedShapeException {
        DrawShape drawShape = null;
        if (shapeName.equalsIgnoreCase("circle")) {
            drawShape = new DrawCircle();
        } else if (shapeName.equalsIgnoreCase("rectangle")) {
            drawShape = new DrawRectangle();
        } else
            throw new UnSupportedShapeException();
        return drawShape;
    }
//自定义UnSupportedShapeException异常类
public class UnSupportedShapeException extends Exception {
    public UnSupportedShapeException() {
        // TODO Auto-generated constructor stub
        super();
    }

    public String toString() {
        // TODO Auto-generated method stub
        return "不支持该图形！！";
    }
}
*/</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// TODO Auto-generated method stub</span>
        DrawShape drawShape<span class="token punctuation">;</span>
        drawShape <span class="token operator">=</span> ShapeFactory<span class="token punctuation">.</span><span class="token function">getShape</span><span class="token punctuation">(</span><span class="token string">"rectangle"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        drawShape<span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
</li>
</ul>
<p>  使用配置文件：（在客户端创建具体形状对象时，每更换一个Chart对象都需要修改客户 端代码中静态工厂方法的参数，客户端代码将要重新编译，这对于客户端而言，违反了“开闭原则”）</p>
<pre class=" language-java"><code class="language-java">  <span class="token comment" spellcheck="true">//config.xml</span>
  <span class="token operator">&lt;</span><span class="token operator">?</span>xml version<span class="token operator">=</span><span class="token string">"1.0"</span> encoding<span class="token operator">=</span><span class="token string">"UTF-8"</span><span class="token operator">?</span><span class="token operator">></span>
  <span class="token operator">&lt;</span>config<span class="token operator">></span>
  <span class="token operator">&lt;</span>shapeName<span class="token operator">></span>rectangle<span class="token operator">&lt;</span><span class="token operator">/</span>shapeName<span class="token operator">></span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>config<span class="token operator">></span>

  <span class="token comment" spellcheck="true">//注意导入的包名称</span>
  <span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>File<span class="token punctuation">;</span>
  <span class="token keyword">import</span> javax<span class="token punctuation">.</span>xml<span class="token punctuation">.</span>parsers<span class="token punctuation">.</span>DocumentBuilder<span class="token punctuation">;</span>
  <span class="token keyword">import</span> javax<span class="token punctuation">.</span>xml<span class="token punctuation">.</span>parsers<span class="token punctuation">.</span>DocumentBuilderFactory<span class="token punctuation">;</span>
  <span class="token keyword">import</span> org<span class="token punctuation">.</span>w3c<span class="token punctuation">.</span>dom<span class="token punctuation">.</span>Document<span class="token punctuation">;</span>
  <span class="token keyword">import</span> org<span class="token punctuation">.</span>w3c<span class="token punctuation">.</span>dom<span class="token punctuation">.</span>Node<span class="token punctuation">;</span>
  <span class="token keyword">import</span> org<span class="token punctuation">.</span>w3c<span class="token punctuation">.</span>dom<span class="token punctuation">.</span>NodeList<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">XMLUtil</span> <span class="token punctuation">{</span>
      <span class="token comment" spellcheck="true">// 从配置文件中提取形状名称，返回shapeName</span>
      <span class="token keyword">public</span> <span class="token keyword">static</span> String <span class="token function">getShapeName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">try</span> <span class="token punctuation">{</span>
              <span class="token comment" spellcheck="true">// 创建文件对象</span>
              DocumentBuilderFactory dFactory <span class="token operator">=</span> DocumentBuilderFactory<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              DocumentBuilder builder <span class="token operator">=</span> dFactory<span class="token punctuation">.</span><span class="token function">newDocumentBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              Document document<span class="token punctuation">;</span>
              document <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">"lib/config.xml"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token comment" spellcheck="true">// 获取文本节点</span>
              NodeList nodeList <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">"shapeName"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              Node classNode <span class="token operator">=</span> nodeList<span class="token punctuation">.</span><span class="token function">item</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFirstChild</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              String shapeName <span class="token operator">=</span> classNode<span class="token punctuation">.</span><span class="token function">getNodeValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token keyword">return</span> shapeName<span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token comment" spellcheck="true">// TODO: handle exception</span>
              e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token keyword">return</span> null<span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment" spellcheck="true">//测试</span>
  <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{</span>
      <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>
          DrawShape drawShape<span class="token punctuation">;</span>
          String shapeName <span class="token operator">=</span>XMLUtil<span class="token punctuation">.</span><span class="token function">getShapeName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          drawShape <span class="token operator">=</span> ShapeFactory<span class="token punctuation">.</span><span class="token function">getShape</span><span class="token punctuation">(</span>shapeName<span class="token punctuation">)</span><span class="token punctuation">;</span>
          drawShape<span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span></code></pre>
<h3 id="工厂模式"><a href="#工厂模式" class="headerlink" title="工厂模式"></a><strong>工厂模式</strong></h3><ul>
<li><p>设计模式的意图</p>
<ul>
<li>简单工厂存在一个严重的问题，当需要引入新产品时，由于静态工厂方法通过传入的参数来创建不同的产品，这必定需要修改工厂类的代码，违背了“开闭原则”</li>
<li>简单工厂模式中，所有的产品都由同一个工厂创建，工厂类职责较重，业务逻辑较为复杂，具体产品与工厂类之间的耦合度高，严重影响了系统的灵活性 和扩展性，而工厂方法模式则可以很好地解决这一问题</li>
</ul>
</li>
<li><p>解决什么问题，什么时候使用该设计模式</p>
<ul>
<li><p>封装一些类对象的初始化过程，<strong>初始化工作较为复杂</strong>，例如需要初始化其他相关的类，还有可能需要读取配置文件（例如连接数据库或创建文件），导致代码较长，如果将它们都写在构造函数中，会导致构造函数庞大，不利于代码的修改和维护；</p>
</li>
<li><p>需要提供一种灵活的方式来选择<strong>对象</strong>（例如日志记录器），尽量<strong>不修改源代码的情况下</strong>更换或增加 <strong>对象的方法</strong>（日志记录方式）</p>
<p><strong>实例</strong>：如何封装记录器的初始化过程并保证多种记录器切换的灵活性</p>
</li>
</ul>
</li>
<li><p>怎样解决</p>
<ul>
<li>一个用于创建对象的接口，让子类决定将哪一个类实例化。工厂方法模式让一个类的实例化延迟到其子类。工厂方法模式又简称为工厂模式 (Factory    Pattern)，又可称作虚拟构造器模式(Virtual Constructor    Pattern)或多态工厂模式 (Polymorphic    Factory    Pattern)。工厂方法模式是一种类创建型模式。</li>
<li>工厂方法模式中，我们不再提供一个统一的工厂类来创建所有的产品对象，而是针对不同 的产品提供不同的工厂，系统提供一个与产品等级结构对应的工厂等级结构。</li>
</ul>
</li>
<li><p>结构图</p>
<ul>
<li><img src="https://shapefire.github.io/posts/911124684/FactoryModelConstructionImg.PNG" alt="FactoryModelConstruction"></li>
</ul>
</li>
<li><p>Product（抽象产品）：它是定义产品的接口，是工厂方法模式所创建对象的超类型，也就是产品对象的公共父类。</p>
</li>
<li><p>Factory（抽象工厂）：在抽象工厂类中，声明了工厂方法(Factory    Method)，用于返回一个 产品。抽象工厂是工厂方法模式的核心，所有创建对象的工厂类都必须实现该接口</p>
</li>
<li><p>ConcreteProduct（具体产品）：它实现了抽象产品接口，某种类型的具体产品由专门的具体 工厂创建，具体工厂和具体产品之间一一对应。</p>
</li>
<li><p>ConcreteFactory（具体工厂）：它是抽象工厂类的子类，实现了抽象工厂中定义的工厂方 法，并可由客户端调用，返回一个具体产品类的实例</p>
</li>
<li><p>关键代码</p>
<ul>
<li><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//与简单工厂模式相比，工厂方法模式最重要的区别是引入了抽象工厂角色，抽象工厂可以是 接口，也可以是抽象类或者具体类</span>
<span class="token keyword">interface</span>    <span class="token class-name">Factory</span>    <span class="token punctuation">{</span>            
    <span class="token keyword">public</span>    Product    <span class="token function">factoryMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
 <span class="token punctuation">}</span></code></pre>
</li>
<li><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//在抽象工厂中声明了工厂方法但并未实现工厂方法，具体产品对象的创建由其子类负责</span>
<span class="token keyword">class</span>    <span class="token class-name">ConcreteFactory</span>    <span class="token keyword">implements</span>    <span class="token class-name">Factory</span>    <span class="token punctuation">{</span>            
    <span class="token keyword">public</span>    Product    <span class="token function">factoryMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>    
        <span class="token keyword">return</span>    <span class="token keyword">new</span>    <span class="token class-name">ConcreteProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        
    <span class="token punctuation">}</span>        
<span class="token punctuation">}</span></code></pre>
</li>
<li><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//在客户端代码中，只需关心工厂类即可，不同的具体工厂可以创建不同的产品，典型的客户 端类代码片段如下所示：</span>
……        
Factory    factory<span class="token punctuation">;</span>    
factory    <span class="token operator">=</span>    <span class="token keyword">new</span>    <span class="token class-name">ConcreteFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//可通过配置文件实现    </span>
Product    product<span class="token punctuation">;</span>        
product    <span class="token operator">=</span>    factory<span class="token punctuation">.</span><span class="token function">factoryMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
……</code></pre>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>应用实例</p>
<ul>
<li>生活中：</li>
<li>软件中：</li>
</ul>
</li>
<li><p>优点</p>
<ul>
<li>工厂方法用来创建客户所需要的产品，同时还向客户隐藏了哪种具体产品类将被实例化这一细节，用户<strong>只需要关心所需产品对应的工厂</strong>，无须关心创建细节，甚至无须知道具体产品类的类名</li>
<li><strong>基于工厂角色和产品角色的多态性设计</strong>是工厂方法模式的<strong>关键</strong>。它能够让工厂可以自主确定创建何种产品对象，而如何创建这个对象的细节则完全封装在具体工厂内部。工厂方法模 式之所以又被称为多态工厂模式，就正是因为所有的具体工厂类都具有同一抽象父类。</li>
<li>在系统中加入新产品时<strong>，无须修改</strong>抽象工厂和抽象产品 提供的接口，无须修改客户端，也无须修改其他的具体工厂和具体产品，而<strong>只要添加</strong>一个具体工厂和具体产品就可以了,完全符合开闭原则</li>
</ul>
</li>
<li><p>缺点</p>
<ul>
<li>在添加新产品时，需要编写新的具体产品类，而且还要提供与之对应的具体工厂类，系统中类的个数将成对增加，在一定程度上<strong>增加了系统的复杂度</strong>，有更多的类需要编译和运行， 会给系统带来一些额外的开销。</li>
<li>由于考虑到系统的可扩展性，需要引入抽象层，在客户端代码中均使用抽象层进行定义，<strong>增加了系统的抽象性和理解难度</strong>，且在实现时可能需要用到DOM、反射等技术，<strong>系统的实现难度增加</strong>。</li>
</ul>
</li>
<li><p>注意事项</p>
<ul>
<li><p>在以下情况下可以考虑使用工厂方法模式：</p>
<ol>
<li><strong>客户端不知道它所需要的对象的类</strong>。在工厂方法模式中，客户端不需要知道具体产品类的 类名，只需要知道所对应的工厂即可，具体的产品对象由具体工厂类创建，可将具体工厂类 的类名存储在配置文件或数据库中</li>
<li><strong>抽象工厂类通过其子类来指定创建哪个对象</strong>。在工厂方法模式中，对于抽象工厂类只需要 提供一个创建产品的接口，而由其子类来确定具体要创建的对象，利用面向对象的多态性和 里氏代换原则，在程序运行时，子类对象将覆盖父类对象，从而使得系统更容易扩展。</li>
</ol>
</li>
<li><p>有人说：可以在客户端代码中直接通过反射机制来生成产品对象，在定义产品对象时使用抽 象类型，同样可以确保系统的灵活性和可扩展性，增加新的具体产品类无须修改源代码，只 需要将其作为抽象产品类的子类再修改配置文件即可，根本不需要抽象工厂类和具体工厂 类。<br>试思考这种做法的可行性？如果可行，这种做法是否存在问题？为什么</p>
<p><strong>A: 不行</strong>，<strong>工厂的作用除了将对象的创建和对象的使用分离之外，还有一个作用就是可以屏蔽一些对象初始化的工作，如果直接反射得到具体产品对象，那么反射之后，需要每次做初始化工作，而工厂中就直接初始化完成了。反射生成对象只能适用一些最简单的情况，如果对象的创建比较复杂，例如要调用有参的构造函数，创建之前需要配置相应的环境，则需要将这些代码封装到工厂中，而工厂的作用不仅仅是简单的创建一个对象</strong></p>
</li>
</ul>
</li>
<li><p>练习：使用工厂方法模式设计一个程序来读取各种不同类型的图片格式，针对每一种图片格式都设 计一个图片读取器，如GIF图片读取器用于读取GIF格式的图片、JPG图片读取器用于读取JPG 格式的图片。需充分考虑系统的灵活性和可扩展性。</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//ReadImg.class</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ReadImg</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">readImg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//GifReadImg.class</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GifReadImg</span> <span class="token keyword">implements</span> <span class="token class-name">ReadImg</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">readImg</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// TODO Auto-generated method stub</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"读取Gif格式的图片"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//JpgReadImg.class</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JpgReadImg</span> <span class="token keyword">implements</span> <span class="token class-name">ReadImg</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">readImg</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// TODO Auto-generated method stub</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"读取Jpg格式的图片"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//ReadImgFactory.class</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ReadImgFactory</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> ReadImg <span class="token function">createReadImg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//GifReadImgFactory.class</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GifReadImgFactory</span> <span class="token keyword">implements</span> <span class="token class-name">ReadImgFactory</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> ReadImg <span class="token function">createReadImg</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// TODO Auto-generated method stub</span>
        ReadImg gifReadImg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GifReadImg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> gifReadImg<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//JpgReadImgFactory.class</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JpgReadImgFactory</span> <span class="token keyword">implements</span> <span class="token class-name">ReadImgFactory</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> ReadImg <span class="token function">createReadImg</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// TODO Auto-generated method stub</span>
        ReadImg jpgReadImg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JpgReadImg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> jpgReadImg<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//XMLUtil.class</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> Object <span class="token function">getImgType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            DocumentBuilderFactory documentBuilderFactory <span class="token operator">=</span> DocumentBuilderFactory<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            DocumentBuilder documentBuilder <span class="token operator">=</span> documentBuilderFactory<span class="token punctuation">.</span><span class="token function">newDocumentBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            Document document <span class="token operator">=</span> documentBuilder<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">"lib/config.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            NodeList nodeList <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">"imgType"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            Node classNode <span class="token operator">=</span> nodeList<span class="token punctuation">.</span><span class="token function">item</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFirstChild</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            String className <span class="token operator">=</span> classNode<span class="token punctuation">.</span><span class="token function">getNodeValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment" spellcheck="true">// 使用Class.forName()方法创建实例必须是类的全路径否则提示ClassNotFound错误</span>
            Class <span class="token class-name">cName</span> <span class="token operator">=</span> Class<span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"com.designModel.factoryModel."</span> <span class="token operator">+</span> className<span class="token punctuation">)</span><span class="token punctuation">;</span>
            Object object <span class="token operator">=</span> cName<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> object<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// TODO: handle exception</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> null<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<pre class=" language-xml"><code class="language-xml">//config.xml
<span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>config</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>imgType</span><span class="token punctuation">></span></span>GifReadImgFactory<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>imgType</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>config</span><span class="token punctuation">></span></span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//Client.class</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// TODO Auto-generated method stub</span>
        <span class="token comment" spellcheck="true">/* 未使用配置文件
         * ReadImgFactory readImgFactory; ReadImg readImg; readImgFactory = new
         * JpgReadImgFactory(); readImg = readImgFactory.createReadImg();
         * readImg.readImg();
         */</span>
        ReadImgFactory readImgFactory<span class="token punctuation">;</span>
        ReadImg readImg<span class="token punctuation">;</span>
        readImgFactory <span class="token operator">=</span> <span class="token punctuation">(</span>ReadImgFactory<span class="token punctuation">)</span> XMLUtil<span class="token punctuation">.</span><span class="token function">getImgType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        readImg <span class="token operator">=</span> readImgFactory<span class="token punctuation">.</span><span class="token function">createReadImg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        readImg<span class="token punctuation">.</span><span class="token function">readImg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
</li>
</ul>
<h3 id="抽象工厂模式"><a href="#抽象工厂模式" class="headerlink" title="抽象工厂模式"></a>抽象工厂模式</h3><ul>
<li><p>设计模式的意图</p>
<ul>
<li>由 于工厂方法模式中的每个工厂只生产一类产品，可能会导致系统中存在大量的工厂类，势必会增加系统的开销</li>
<li>抽象工厂的基本思想：<strong>考虑将一些相关的产品组成一个“产品族”，由同一个工厂来统一生产</strong></li>
<li>两个重要概念：<ul>
<li>产品等级结构：产品等级结构即产品的继承结构，如一个抽象类是电视机，其子类有海尔 电视机、海信电视机、TCL电视机，则抽象电视机与具体品牌的电视机之间构成了一个产品等 级结构，抽象电视机是父类，而具体品牌的电视机是其子类。</li>
<li>产品族：在抽象工厂模式中，产品族是指由同一个工厂生产的，位于不同产品等级结构中 的一组产品，如海尔电器工厂生产的海尔电视机、海尔电冰箱，海尔电视机位于电视机产品 等级结构中，海尔电冰箱位于电冰箱产品等级结构中，海尔电视机、海尔电冰箱构成了一个 产品族。</li>
<li><img src="https://shapefire.github.io/posts/911124684/produceLevel.PNG" alt="produceLevel"></li>
<li>抽象工厂模式与工厂方法模式<strong>最大的区别</strong>：工厂方法模式针对的是一个产品等级结构，而抽象工厂模式需要面对多个产品等级结构，一 个工厂等级结构可以负责多个不同产品等级结构中的产品对象的创建。</li>
<li>抽象工厂模式是工厂方法模式的进一步延伸，由于它提供了功能更为强大的工厂类并且具备 较好的可扩展性，在软件开发中得以广泛应用，尤其是在<strong>一些框架和API类库的设计</strong>中</li>
</ul>
</li>
</ul>
</li>
<li><p>解决什么问题，什么时候使用该设计模式</p>
<ul>
<li>在工厂模式的前提下：增加新的功能时，需要增加大量的类，针对每一个新增具体功能都需要增加一个具体工厂，类的个数成对增加，这无疑会导致系统越来越庞大增加系统的维护成本和运行开销</li>
<li>系统中有多于一个的产品族，而每次只使用其中某一产品族。例如在界面皮肤系统中，有多种不同的皮肤风格（产品族）例如黑色风格，白色风格，每种颜色所拥有的的对应组件都是一个产品族。</li>
<li><strong>当系统所提供的工厂生产的具体产品并不是一个简单的对象，而是多个位于不同产品等级结 构、属于不同类型的具体产品时就可以使用抽象工厂模式</strong></li>
</ul>
</li>
<li><p>怎样解决</p>
<ul>
<li>抽象工厂模式中 的具体工厂<strong>不只是</strong>创建一种产品，它负责创建<strong>一族</strong>产品</li>
<li>提供一个创建一系列相关或相互依赖对象的接口，而无须指定它们具体的类。抽象工厂模式又称为Kit模式，它是一种对象创建型模式</li>
</ul>
</li>
<li><p>结构图</p>
<ul>
<li><img src="/posts/911124684/abstractFactoryConstructionImg.PNG" alt="abstractFactoryConstruction"></li>
<li>​    AbstractFactory（抽象工厂）：它声明了一组用于创建一族产品的方法，每一个方法对应一 种产品</li>
<li>​    ConcreteFactory（具体工厂）：它实现了在抽象工厂中声明的创建产品的方法，生成一组具 体产品，这些产品构成了一个产品族，每一个产品都位于某个产品等级结构中</li>
<li>AbstractProduct（抽象产品）：它为每种产品声明接口，在抽象产品中声明了产品所具有的 业务方法</li>
<li>ConcreteProduct（具体产品）：它定义具体工厂生产的具体产品对象，实现抽象产品接口中 声明的业务方法</li>
</ul>
</li>
<li><p>关键代码</p>
<ul>
<li><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//抽象工厂中声明了多个工厂方法，用于创建不同类型的产品，抽象工厂可以是接口，也可以是抽象类或者具体类</span>
<span class="token keyword">abstract</span>    <span class="token keyword">class</span>    <span class="token class-name">AbstractFactory</span>    <span class="token punctuation">{</span>    
    <span class="token comment" spellcheck="true">//有多少个产品（产品等级）就需要多少个产品工厂</span>
    <span class="token keyword">public</span>    <span class="token keyword">abstract</span>    AbstractProductA    <span class="token function">createProductA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//工厂方法一    </span>
    <span class="token keyword">public</span>    <span class="token keyword">abstract</span>    AbstractProductB    <span class="token function">createProductB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//工厂方法二    </span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    
<span class="token punctuation">}</span>
</code></pre>
</li>
<li><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//具体工厂实现了抽象工厂，每一个具体的工厂方法可以返回一个特定的产品对象，而同一个 具体工厂所创建的产品对象构成了一个产品族。</span>
<span class="token keyword">class</span>    <span class="token class-name">ConcreteFactory1</span>    <span class="token keyword">extends</span>    <span class="token class-name">AbstractFactory</span>    <span class="token punctuation">{</span>                        
    <span class="token comment" spellcheck="true">//工厂方法一        </span>
    <span class="token keyword">public</span>    AbstractProductA    <span class="token function">createProductA</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>                                <span class="token keyword">return</span>    <span class="token keyword">new</span>    <span class="token class-name">ConcreteProductA1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">//工厂方法二        </span>
    <span class="token keyword">public</span>    AbstractProductB    <span class="token function">createProductB</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>                        <span class="token keyword">return</span>    <span class="token keyword">new</span>    <span class="token class-name">ConcreteProductB1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        
          <span class="token punctuation">}</span>    
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span></code></pre>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>应用实例</p>
<ul>
<li>生活中：</li>
<li>软件中：</li>
</ul>
</li>
<li><p>优点</p>
<ul>
<li>抽象工厂模式隔离了具体类的生成，使得客户并不需要知道什么被创建。</li>
<li>当一个产品族中的多个对象被设计成一起工作时，它能够保证客户端始终只使用同一个产 品族中的对象</li>
<li>增加新的产品族很方便，无须修改已有系统，符合“开闭原则”。</li>
</ul>
</li>
<li><p>缺点</p>
<ul>
<li>增加新的产品等级结构麻烦，需要对原有系统进行较大的修改，甚至需要修改抽象层代码， 这显然会带来较大的不便，违背了“开闭原则”。</li>
</ul>
</li>
<li><p>开闭原则的倾斜性</p>
</li>
<li><p>抽象工厂模式存在“开闭原则”的倾斜性，它以一种倾斜的方式来满足“开闭原则”，为增 加新产品族提供方便，但不能为增加新产品结构提供这样的方便</p>
</li>
<li><p>注意事项</p>
<ul>
<li><p>适用场景：</p>
<ul>
<li>系统中有多于一个的产品族，而每次只使用其中某一产品族。可以通过配置文件等方式来 使得用户可以动态改变产品族，也可以很方便地增加新的产品族。</li>
<li>属于同一个产品族的产品将在一起使用，这一约束必须在系统的设计中体现出来。同一个 产品族中的产品可以是没有任何关系的对象，但是它们都具有一些共同的约束，如同一操作 系统下的按钮和文本框，按钮与文本框之间没有直接关系，但它们都是属于某一操作系统 的，此时具有一个共同的约束条件：操作系统的类型。</li>
<li>产品等级结构稳定，设计完成之后，不会向系统中增加新的产品等级结构或者删除已有的 产品等级结构。</li>
</ul>
</li>
<li><p><strong>使用抽象工厂模式时，必须确定产品的等级结构，否则添加一个新的产品等级将极大的麻烦。</strong></p>
</li>
</ul>
</li>
<li><p>练习：Sunny软件公司欲推出一款新的手机游戏软件，该软件能够支持Symbian、Android和 Windows    Mobile等多个智能手机操作系统平台，针对不同的手机操作系统，该游戏软件提 供了不同的游戏操作控制(OperationController)类和游戏界面控制(InterfaceController)类， 并提供相应的工厂类来封装这些类的初始化过程。软件要求具有较好的扩展性以支持新 的操作系统平台，为了满足上述需求，试采用抽象工厂模式对其进行设计</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//interfaceController 界面控制接口</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">InterfaceController</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//初始化</span>
<span class="token punctuation">}</span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AndroidInterfaceController</span> <span class="token keyword">implements</span> <span class="token class-name">InterfaceController</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Andoid系统的界面控制初始化"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SymbianInterfaceController</span> <span class="token keyword">implements</span> <span class="token class-name">InterfaceController</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Symbian系统的界面控制初始化"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WindowsMobileInterfaceController</span> <span class="token keyword">implements</span> <span class="token class-name">InterfaceController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// TODO Auto-generated method stub</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"WindowsMobile系统的界面控制初始化"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//OperationController 操作控制接口</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">OperationController</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initOperation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AndroidOperationController</span> <span class="token keyword">implements</span> <span class="token class-name">OperationController</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initOperation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Android系统的操作控制初始化"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SymbianOperationController</span> <span class="token keyword">implements</span> <span class="token class-name">OperationController</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initOperation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Symbian系统的操作控制初始化"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WindowsMobileOperationController</span> <span class="token keyword">implements</span> <span class="token class-name">OperationController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initOperation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// TODO Auto-generated method stub</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"WindowsMobile系统的操作控制初始化"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IFactory</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">//创建界面控制对象</span>
    <span class="token keyword">public</span> InterfaceController <span class="token function">createInterfaceController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">//创建操作控制对象</span>
    <span class="token keyword">public</span> OperationController <span class="token function">createOperationController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AndroidFactory</span> <span class="token keyword">implements</span> <span class="token class-name">IFactory</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> InterfaceController <span class="token function">createInterfaceController</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// TODO Auto-generated method stub</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">AndroidInterfaceController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> OperationController <span class="token function">createOperationController</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// TODO Auto-generated method stub</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">AndroidOperationController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SymbianFactory</span> <span class="token keyword">implements</span> <span class="token class-name">IFactory</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> InterfaceController <span class="token function">createInterfaceController</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// TODO Auto-generated method stub</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SymbianInterfaceController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> OperationController <span class="token function">createOperationController</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// TODO Auto-generated method stub</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SymbianOperationController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SymbianFactory</span> <span class="token keyword">implements</span> <span class="token class-name">IFactory</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> InterfaceController <span class="token function">createInterfaceController</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// TODO Auto-generated method stub</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SymbianInterfaceController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> OperationController <span class="token function">createOperationController</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// TODO Auto-generated method stub</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SymbianOperationController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">XMLUtil</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> Object <span class="token function">getSystemType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            DocumentBuilderFactory documentBuilderFactory <span class="token operator">=</span> DocumentBuilderFactory<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            DocumentBuilder documentBuilder <span class="token operator">=</span> documentBuilderFactory<span class="token punctuation">.</span><span class="token function">newDocumentBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            Document document <span class="token operator">=</span> documentBuilder<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">"lib/config.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            NodeList nodeList <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">"systemType"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            Node classNode <span class="token operator">=</span> nodeList<span class="token punctuation">.</span><span class="token function">item</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFirstChild</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            String className <span class="token operator">=</span> classNode<span class="token punctuation">.</span><span class="token function">getNodeValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            Class<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span> cName <span class="token operator">=</span> Class<span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"com.designPattern.abstractFactory.factory."</span> <span class="token operator">+</span> className<span class="token punctuation">)</span><span class="token punctuation">;</span>
            Object object <span class="token operator">=</span> cName<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> object<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// TODO: handle exception</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> null<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">/*
         * 无XML文件配置 
         * IFactory iFactory; OperationController operationController;
         * InterfaceController interfaceController; iFactory = new
         * WindowsMobileFactory(); operationController =
         * iFactory.createOperationController(); interfaceController =
         * iFactory.createInterfaceController(); operationController.initOperation();
         * interfaceController.initInterface();
         */</span>
        IFactory iFactory<span class="token punctuation">;</span>
        OperationController operationController<span class="token punctuation">;</span>
        InterfaceController interfaceController<span class="token punctuation">;</span>
        iFactory <span class="token operator">=</span> <span class="token punctuation">(</span>IFactory<span class="token punctuation">)</span> XMLUtil<span class="token punctuation">.</span><span class="token function">getSystemType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        operationController <span class="token operator">=</span> iFactory<span class="token punctuation">.</span><span class="token function">createOperationController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        interfaceController <span class="token operator">=</span> iFactory<span class="token punctuation">.</span><span class="token function">createInterfaceController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        operationController<span class="token punctuation">.</span><span class="token function">initOperation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        interfaceController<span class="token punctuation">.</span><span class="token function">initInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
</li>
</ul>
<pre class=" language-xml"><code class="language-xml">  <span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>config</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>systemType</span><span class="token punctuation">></span></span>WindowsMobileFactory<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>systemType</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>config</span><span class="token punctuation">></span></span></code></pre>
<h3 id="单例模式"><a href="#单例模式" class="headerlink" title="单例模式"></a>单例模式</h3><ul>
<li><p>设计模式的意图</p>
<ul>
<li><p>对于一个软件系统的某些类而言，无须创建多个实例；例如Windows的任务管理器</p>
</li>
<li><p>为了节约系统资源</p>
</li>
<li><p>解决什么问题，什么时候使用该设计模式</p>
<ul>
<li>需要确保系统中某 个类只有唯一一个实例</li>
<li>确保对象的唯一性</li>
</ul>
</li>
<li><p>怎样解决</p>
</li>
<li><p>通过如下三步来对该类进行设计：</p>
<ul>
<li><p>确保实例的唯一性，需要禁止类的外部直接使用new来创建对象，因此需要将<strong>构造函数的可见性</strong>设置为<strong>private</strong></p>
</li>
<li><p>在类中创建并保存唯一实例，为了让外界可以访问这个唯一实例，需要在类中定义一个静态的类对象类型的私有成员变量 。例如：在User 类中定义静态的User类型的私有成员变量；</p>
<p>​       private static User user = null；</p>
</li>
<li><p>增加一个<strong>公有的静态方法</strong>用来在其他类中使用和实例化该私有的成员变量；</p>
<p>代码示例：获取 private static User user；</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> User <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>user <span class="token operator">==</span> null<span class="token punctuation">)</span><span class="token punctuation">{</span>
        user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> user<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</li>
<li><p>三个要点：</p>
<ul>
<li>某个类<strong>只能</strong>有一个实例</li>
<li>必须自行创建这个实例</li>
<li>必须自行向整个系统提供这个实例</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>结构图</p>
<p><img src="/posts/911124684/singletonConstructionImg.PNG" alt="singletonConstruction"></p>
<ul>
<li>Singleton（单例）：在单例类的内部实现只生成一个实例，同时它提供一个静态的 getInstance()工厂方法，让客户可以访问它的唯一实例；为了防止在外部对其实例化，将其构 造函数设计为私有；在单例类内部定义了一个Singleton类型的静态对象，作为外部共享的唯一 实例</li>
</ul>
</li>
<li><p>关键代码</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">Singleton</span>    <span class="token punctuation">{</span>                    
   <span class="token keyword">private</span>    <span class="token keyword">static</span>    Singleton singleton <span class="token operator">=</span> null<span class="token punctuation">;</span>
   <span class="token keyword">private</span>    <span class="token function">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>    <span class="token punctuation">}</span>            
   <span class="token keyword">public</span>    <span class="token keyword">static</span>    Singleton    <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>
          <span class="token keyword">if</span><span class="token punctuation">(</span>sintleton <span class="token operator">==</span> null<span class="token punctuation">)</span><span class="token punctuation">{</span>
                  singleton <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
       <span class="token keyword">return</span> singleton<span class="token punctuation">;</span>                    
   <span class="token punctuation">}</span>                    
 <span class="token punctuation">}</span></code></pre>
</li>
</ul>
<h4 id="单例类的两种不同的实现方式："><a href="#单例类的两种不同的实现方式：" class="headerlink" title="单例类的两种不同的实现方式："></a>单例类的两种不同的实现方式：</h4><h5 id="饿汉式单例：实现最简单的单例类"><a href="#饿汉式单例：实现最简单的单例类" class="headerlink" title="饿汉式单例：实现最简单的单例类"></a>饿汉式单例：实现最简单的单例类</h5><ul>
<li><p>结构图：</p>
<p><img src="/posts/911124684/eagerSingletonConstruction.PNG" alt="eagerSingletonConstruction"></p>
<p>在定义静态变量的时候实例化单例类，因此在<strong>类加载的时候</strong>就已经创建了单例对象</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">EagerSingleton</span>    <span class="token punctuation">{</span>                            <span class="token keyword">private</span>    <span class="token keyword">static</span>    <span class="token keyword">final</span>    EagerSingleton    instance    <span class="token operator">=</span>    <span class="token keyword">new</span>    <span class="token class-name">EagerSingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
   <span class="token keyword">private</span>    <span class="token function">EagerSingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>    <span class="token punctuation">}</span>            
   <span class="token keyword">public</span>    <span class="token keyword">static</span>    EagerSingleton    <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>
       <span class="token keyword">return</span>    instance<span class="token punctuation">;</span>                    
   <span class="token punctuation">}</span>                    
 <span class="token punctuation">}</span></code></pre>
<p>当<strong>类被加载</strong>时，静态变量instance会被初始化，此时类的私有构造函数会被调用，单例类的唯 一实例将被创建</p>
</li>
</ul>
<h5 id="懒汉式单例类与线程锁定"><a href="#懒汉式单例类与线程锁定" class="headerlink" title="懒汉式单例类与线程锁定"></a>懒汉式单例类与线程锁定</h5><ul>
<li><p>结构图</p>
<p><img src="/posts/911124684/lazySingletonConstruction.PNG" alt="lazySingletonConstruction"></p>
<p>懒汉式单例在第一次调用getInstance()方法时实例化，在类加载时并不自 行实例化，这种技术又称为<strong>延迟加载(Lazy    Load)技术</strong>，即<strong>需要的时候再加载实例</strong>，为了避免多个线程同时调用getInstance()方法，使用关键字<strong>synchronized</strong></p>
<ul>
<li><p><strong>延迟加载技术</strong>（Lazy Load）</p>
<p>延迟加载，可以简单理解为，只有在使用的时候才会执行相关操作</p>
<ul>
<li>用途： 网页中的图片加载 ，hibernate的数据库查询等等</li>
</ul>
</li>
<li><p>关键字 <strong>synchronized</strong></p>
<ul>
<li><p>为什么使用：并发编程中存在<strong>线程安全问题</strong>，主要原因有：1.存在共享数据    2.多线程共同操作共享数据</p>
</li>
<li><p>作用：synchronized可以保证<strong>在同一时刻</strong>，<strong>只有一个线程</strong>可以执行某个方法或某个代码块，同时synchronized可以<strong>保证一个线程的变化可见</strong>（可见性），即可以代替volatile  （synchronize 是java总解决并发问题的一种最常用最简单的方法，确保线程互斥的访问同步）</p>
</li>
<li><p>应用方式：</p>
</li>
<li><p>Java中每一个对象都可以作为锁，这是synchronized实现同步的基础：</p>
<ol>
<li>普通同步方法（实例方法），锁是当前实例对象 ，进入同步代码前要获得当前实例的锁</li>
<li>静态同步方法，锁是当前类的class对象 ，进入同步代码前要获得当前类对象的锁</li>
<li>同步方法块，锁是括号里面的对象，对给定对象加锁，进入同步代码库前要获得给定对象的锁</li>
</ol>
</li>
</ul>
</li>
<li><p>关键代码：</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">class</span>    <span class="token class-name">LazySingleton</span>    <span class="token punctuation">{</span>    
    <span class="token keyword">private</span>    <span class="token keyword">static</span>    LazySingleton    instance    <span class="token operator">=</span>    null<span class="token punctuation">;</span>    
    <span class="token keyword">private</span>    <span class="token function">LazySingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>    <span class="token punctuation">}</span>

    <span class="token keyword">synchronized</span>    <span class="token keyword">public</span>    <span class="token keyword">static</span>    LazySingleton    <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>
        <span class="token keyword">if</span>    <span class="token punctuation">(</span>instance    <span class="token operator">==</span>    null<span class="token punctuation">)</span>    <span class="token punctuation">{</span>
          instance    <span class="token operator">=</span>    <span class="token keyword">new</span>    <span class="token class-name">LazySingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>                                                               
      <span class="token keyword">return</span>    instance<span class="token punctuation">;</span>                            
     <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>上述代码运行时，每次调用getInstance()时 都需要进行<strong>线程锁定判断</strong>，在多线程高并发访问环境中，将会导致<strong>系统性能大大降低</strong>。</p>
<p>改进：将synchornate关键字作用于 instance    =    new    LazySingleton()字句中也会出现产生多个单例对象，所以需要利用双重检查锁定的方式实现</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">class</span>    <span class="token class-name">LazySingleton</span>    <span class="token punctuation">{</span>                            
    <span class="token keyword">private</span>    <span class="token keyword">volatile</span>    <span class="token keyword">static</span>    LazySingleton    instance    <span class="token operator">=</span>    null<span class="token punctuation">;</span>

    <span class="token keyword">private</span>    <span class="token function">LazySingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>    <span class="token punctuation">}</span>        
    <span class="token keyword">public</span>    <span class="token keyword">static</span>    LazySingleton    <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">//第一重判断    </span>
        <span class="token keyword">if</span>    <span class="token punctuation">(</span>instance    <span class="token operator">==</span>    null<span class="token punctuation">)</span>    <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">//锁定代码块    </span>
          <span class="token keyword">synchronized</span>    <span class="token punctuation">(</span>LazySingleton<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>
                <span class="token comment" spellcheck="true">//第二重判断        </span>
              <span class="token keyword">if</span>    <span class="token punctuation">(</span>instance    <span class="token operator">==</span>    null<span class="token punctuation">)</span>    <span class="token punctuation">{</span>
                    instance    <span class="token operator">=</span>    <span class="token keyword">new</span>    <span class="token class-name">LazySingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//创建单例实例</span>
              <span class="token punctuation">}</span>            
            <span class="token punctuation">}</span>                                    
      <span class="token punctuation">}</span>                                    
        <span class="token keyword">return</span>    instance<span class="token punctuation">;</span>                            
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>使用双重检查锁定来实现懒汉式单例类，需要在静态成员变量instance之前增加<strong>修饰符volatile</strong>,被volatile修饰的成员变量可以确保多个线程都能够正确处理，且该代 码只能在JDK1.5及以上版本中才能正确执行。</p>
</li>
<li><p>使使用双重检查锁定来实现单例模式也<strong>不是一种完美的实现方式</strong>，因为volatile关键字会<strong>屏蔽</strong>Java虚拟机所做的一 些<strong>代码优化</strong>，可能会导致系统运行<strong>效率降低</strong></p>
</li>
<li><p>两种单例模式比较：</p>
<ol>
<li>饿汉式单例类无须考虑多线程访问问题</li>
<li>懒汉式单例无须一直占用系统资源，但是必须处理多个线程同时访问的问题</li>
<li>在调用速度和反应时间角度：饿汉 优于 懒汉</li>
<li>从资源利用效率角度：懒汉 优于 饿汉</li>
</ol>
</li>
</ul>
</li>
</ul>
<h5 id="更好的单例实现方法（Initialization-Demand-Holder-（IoDH）技术）："><a href="#更好的单例实现方法（Initialization-Demand-Holder-（IoDH）技术）：" class="headerlink" title="更好的单例实现方法（Initialization Demand Holder （IoDH）技术）："></a>更好的单例实现方法（Initialization Demand Holder （IoDH）技术）：</h5><ul>
<li><p>饿汉式单例类不能实现延迟加载，不管将来用不用始终占据内存；懒汉式单例类线程安全控 制烦琐，而且性能受影响，IoDH技术能将两种单例的缺点克服，将优点合而为一</p>
</li>
<li><p>关键代码</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//在单例类中增加一个静态(static)内部类，在该内部类中创建单例对象，再将 该单例对象通过getInstance()方法返回给外部使用，</span>
<span class="token keyword">class</span>    <span class="token class-name">Singleton</span>    <span class="token punctuation">{</span>    
    <span class="token keyword">private</span>    <span class="token function">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>  <span class="token punctuation">}</span>        
    <span class="token keyword">private</span>    <span class="token keyword">static</span>    <span class="token keyword">class</span>    <span class="token class-name">HolderClass</span>    <span class="token punctuation">{</span>
        <span class="token keyword">private</span>    <span class="token keyword">final</span>    <span class="token keyword">static</span>    Singleton    instance    <span class="token operator">=</span>    <span class="token keyword">new</span>        <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            
   <span class="token punctuation">}</span>        
    <span class="token keyword">public</span>    <span class="token keyword">static</span>    Singleton    <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>    
        <span class="token keyword">return</span>    HolderClass<span class="token punctuation">.</span>instance<span class="token punctuation">;</span>                    
    <span class="token punctuation">}</span>        
    <span class="token keyword">public</span>    <span class="token keyword">static</span>    <span class="token keyword">void</span>    <span class="token function">main</span><span class="token punctuation">(</span>String    args<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>
        Singleton    s1<span class="token punctuation">,</span>    s2<span class="token punctuation">;</span>                                
        s1    <span class="token operator">=</span>    Singleton<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        
        s2    <span class="token operator">=</span>    Singleton<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s1<span class="token operator">==</span>s2<span class="token punctuation">)</span><span class="token punctuation">;</span>        
 <span class="token punctuation">}</span>    
<span class="token punctuation">}</span>
</code></pre>
<p>通过使用IoDH，我们既可以实现延迟加载，又可以保证线程安全，不影响系统性能。<strong>缺点：是与编程语言本身的特性相关，很多面向对象 语言不支持IoDH</strong></p>
</li>
</ul>
<ul>
<li><p>应用实例</p>
<ul>
<li>生活中：</li>
<li>软件中：</li>
</ul>
</li>
<li><p>优点</p>
<ul>
<li><p>单例模式提供了对<strong>唯一实例的受控访问</strong>。因为单例类封装了它的唯一实例，所以它可以严 格控制客户怎样以及何时访问它。</p>
</li>
<li><p>由于在系统内存中<strong>只存在一个对象</strong>，因此可以节约系统资源，对于一些需要频繁创建和销 毁的对象单例模式无疑可以提高系统的性能。</p>
</li>
<li><p><strong>允许可变数目的实例</strong>。基于单例模式我们可以进行扩展，使用与单例控制相似的方法来获 得指定个数的对象实例，既节省系统资源，又解决了单例单例对象共享过多有损性能的问 题。</p>
</li>
</ul>
</li>
<li><p>缺点</p>
<ul>
<li>由于单例模式中没有抽象层，因此单例类的<strong>扩展有很大的困难</strong></li>
<li>单例类的<strong>职责过重</strong>，在一定程度上违背了“单一职责原则”。因为单例类既充当了工厂角 色，提供了工厂方法，同时又充当了产品角色，包含一些业务方法，将产品的创建和产品的 本身的功能融合到一起。</li>
<li>现在很多面向对象语言(如Java、C#)的运行环境都提供了自动垃圾回收的技术，因此，如果实例化的共享对象长时间不被利用，系统会认为它是垃圾，会自动销毁并回收资源，下次 利用时又将重新实例化，这将导致<strong>共享的单例对象状态的丢失</strong></li>
</ul>
</li>
<li><p>注意事项</p>
<ul>
<li>系统只需要一个实例对象象，如系统要求提供一个唯一的序列号生成器或资源管理器，或者 需要考虑资源消耗太大而只允许创建一个对象。</li>
<li>客户调用类的单个实例只允许使用一个公共访问点，除了该公共访问点，不能通过其他途 径访问该实例</li>
</ul>
</li>
<li><p>练习：分别使用饿汉式单例、带双重检查锁定机制的懒汉式单例以及IoDH技术实现负载均衡器 LoadBalancer。</p>
<ul>
<li><p>饿汉式：</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//负载均衡器类，充当单例角色  饿汉式单例</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EagerSingletonLoadBalancer</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 私有静态成员变量，存储唯一实例</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> EagerSingletonLoadBalancer instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EagerSingletonLoadBalancer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 服务器集合</span>
    <span class="token keyword">private</span> List serverList <span class="token operator">=</span> null<span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// 私有构造函数</span>
    <span class="token keyword">private</span> <span class="token function">EagerSingletonLoadBalancer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        serverList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// 公有静态成员方法，返回唯一实例</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> EagerSingletonLoadBalancer <span class="token function">getLoadBalancer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> instance<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// 增加服务器</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addServer</span><span class="token punctuation">(</span>String server<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        serverList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>server<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// 删除服务器</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">removeServer</span><span class="token punctuation">(</span>String server<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        serverList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>server<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// 使用Random类随机获取服务器</span>
    <span class="token keyword">public</span> String <span class="token function">getServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Random random <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span>serverList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>String<span class="token punctuation">)</span> serverList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
</li>
<li><p>带双重检查锁定机制的懒汉式</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//负载均衡器类，充当单例角色  带双重检查锁定的懒汉式单例</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LazySingletonLoadBalancer</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 私有静态成员变量，存储唯一实例</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> LazySingletonLoadBalancer instance <span class="token operator">=</span> null<span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 服务器集合</span>
    <span class="token keyword">private</span> List serverList <span class="token operator">=</span> null<span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// 私有构造函数</span>
    <span class="token keyword">private</span> <span class="token function">LazySingletonLoadBalancer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        serverList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// 公有静态成员方法，返回唯一实例</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> LazySingletonLoadBalancer <span class="token function">getLoadBalancer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>instance <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>LazySingletonLoadBalancer<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>instance <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LazySingletonLoadBalancer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> instance<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// 增加服务器</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addServer</span><span class="token punctuation">(</span>String server<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        serverList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>server<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// 删除服务器</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">removeServer</span><span class="token punctuation">(</span>String server<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        serverList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>server<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// 使用Random类随机获取服务器</span>
    <span class="token keyword">public</span> String <span class="token function">getServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Random random <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span>serverList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>String<span class="token punctuation">)</span> serverList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
</li>
<li><p>IoDH技术实现</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//负载均衡器类，充当单例角色 IoDH技术实现的单例</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IoDHSingletonLoadBalancer</span> <span class="token punctuation">{</span>

    <span class="token comment" spellcheck="true">// HolderClass static内部类 , 在内部类中创建单例对象 IoDHSingletonLoadBalancer</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">HolderClass</span> <span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">static</span> IoDHSingletonLoadBalancer instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IoDHSingletonLoadBalancer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> List serverList <span class="token operator">=</span> null<span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// 私有构造函数</span>
    <span class="token keyword">private</span> <span class="token function">IoDHSingletonLoadBalancer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        serverList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// 公有静态成员方法，返回唯一实例</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> IoDHSingletonLoadBalancer <span class="token function">getLoadBalancer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> HolderClass<span class="token punctuation">.</span>instance<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// 增加服务器</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addServer</span><span class="token punctuation">(</span>String server<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        serverList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>server<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// 删除服务器</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">removeServer</span><span class="token punctuation">(</span>String server<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        serverList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>server<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// 使用Random类随机获取服务器</span>
    <span class="token keyword">public</span> String <span class="token function">getServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Random random <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span>serverList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>String<span class="token punctuation">)</span> serverList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
</li>
<li><p>客户端测试</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//客户端测试类  以懒汉式单例为模板</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String args<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// 创建4个LoadBalancer对象</span>
        LazySingletonLoadBalancer balancer1<span class="token punctuation">,</span> balancer2<span class="token punctuation">,</span> balancer3<span class="token punctuation">,</span> balancer4<span class="token punctuation">;</span>
        balancer1 <span class="token operator">=</span> LazySingletonLoadBalancer<span class="token punctuation">.</span><span class="token function">getLoadBalancer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        balancer2 <span class="token operator">=</span> LazySingletonLoadBalancer<span class="token punctuation">.</span><span class="token function">getLoadBalancer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        balancer3 <span class="token operator">=</span> LazySingletonLoadBalancer<span class="token punctuation">.</span><span class="token function">getLoadBalancer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        balancer4 <span class="token operator">=</span> LazySingletonLoadBalancer<span class="token punctuation">.</span><span class="token function">getLoadBalancer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// 判断服务器负载均衡器是否相同</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>balancer1 <span class="token operator">==</span> balancer2 <span class="token operator">&amp;&amp;</span> balancer2 <span class="token operator">==</span> balancer3 <span class="token operator">&amp;&amp;</span> balancer3 <span class="token operator">==</span> balancer4<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"(lazySingleton)服务器负载均衡器具有唯一性！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment" spellcheck="true">// 增加服务器</span>
        balancer1<span class="token punctuation">.</span><span class="token function">addServer</span><span class="token punctuation">(</span><span class="token string">"Server 1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        balancer1<span class="token punctuation">.</span><span class="token function">addServer</span><span class="token punctuation">(</span><span class="token string">"Server 2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        balancer1<span class="token punctuation">.</span><span class="token function">addServer</span><span class="token punctuation">(</span><span class="token string">"Server 3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        balancer1<span class="token punctuation">.</span><span class="token function">addServer</span><span class="token punctuation">(</span><span class="token string">"Server 4"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// 模拟客户端请求的分发，如果输出结果全为同一个server，可以将i适当放大，</span>
        <span class="token comment" spellcheck="true">// 例如改为"i &lt; 100"</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            String server <span class="token operator">=</span> balancer1<span class="token punctuation">.</span><span class="token function">getServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"分发请求至服务器： "</span> <span class="token operator">+</span> server<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
</li>
</ul>
</li>
</ul>
<h3 id="原型模式"><a href="#原型模式" class="headerlink" title="原型模式"></a>原型模式</h3><ul>
<li><p>设计模式的意图</p>
<ul>
<li>在面向对象系统中实现对<strong>已有的对象</strong>进行复制和粘贴</li>
</ul>
</li>
<li><p>解决什么问题，什么时候使用该设计模式</p>
<ul>
<li>将已有的对象保存为模板</li>
<li>在创建对象时能够复制已有对象的模板进行生成</li>
</ul>
</li>
<li><p>怎样解决</p>
<ul>
<li>首先创建一个原型对象，再通过复制这个原型对象来创建更多的<strong>同类型的对象</strong></li>
<li>原型模式(Prototype Pattern)：使用原型实例指定创建对象的种类，并且通过拷贝这些 原型创建新的对象。原型模式是一种<strong>对象创建型模式</strong>。</li>
<li>原型模式是一种“另类”的创建型模式，创建克隆对象的工厂就是原型类自身，工厂方法由<strong>克隆方法</strong>来实现。</li>
<li>是通过克隆方法所创建的对象是<strong>全新的对象</strong>，它们在内存中拥有新的地址，通常 对克隆所产生的对象进行修改对原型对象不会造成任何影响，每一个克隆对象都是<strong>相互独立</strong>的。</li>
</ul>
</li>
<li><p>结构图</p>
<p><img src="/posts/911124684/prototypeConstructionImg.PNG" alt="prototypeConstruction"></p>
<p>Prototype（抽象原型类）：它是声明克隆方法的接口，是所有具体原型类的公共父类，可以 是抽象类也可以是接口，甚至还可以是具体实现类</p>
<p>ConcretePrototype（具体原型类）：它实现在抽象原型类中声明的克隆方法，在克隆方法中 返回自己的一个克隆对象。</p>
<p>Client（客户类）：让一个原型对象克隆自身从而创建一个新的对象，在客户类中<strong>只需要直接实例化或通过工厂方法等方式创建一个原型对象，再通过调用该对象的克隆方法即可得到多个相同的对象</strong>。由于客户类针对抽象原型类Prototype编程，因此用户可以根据需要选择具体原型类，系统具有较好的可扩展性，增加或更换具体原型类都很方便。</p>
</li>
<li><p>关键代码</p>
<ul>
<li><p>通用实现方法：在具体原型类的克隆方法中实例化一个与自身类型相同的对象并将其返回，并将相关的参数传入新创建的对象中，保证它们的成员属性相同</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">class</span>    <span class="token class-name">ConcretePrototype</span>    <span class="token keyword">implements</span>    <span class="token class-name">Prototype</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span>    String attr<span class="token punctuation">;</span>    
    <span class="token comment" spellcheck="true">//成员属性</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setAttr</span><span class="token punctuation">(</span>String    attr<span class="token punctuation">)</span> <span class="token punctuation">{</span>        
        <span class="token keyword">this</span><span class="token punctuation">.</span>attr    <span class="token operator">=</span>    attr<span class="token punctuation">;</span> 
    <span class="token punctuation">}</span> 
    <span class="token keyword">public</span> String <span class="token function">getAttr</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        
        <span class="token keyword">return</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>attr<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> 
    <span class="token keyword">public</span> Prototype <span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">//克隆方法 </span>
    <span class="token punctuation">{</span>                
        Prototype prototype    <span class="token operator">=</span>    <span class="token keyword">new</span>    <span class="token class-name">ConcretePrototype</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token comment" spellcheck="true">//创建新对象        </span>
        prototype<span class="token punctuation">.</span><span class="token function">setAttr</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>attr<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token keyword">return</span>    prototype<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//在客户类中我们只需要创建一个ConcretePrototype对象作为原型对象，然后调用其clone()方法 即可得到对应的克隆对象，如下代码所示：</span>

Prototype    obj1 <span class="token operator">=</span>    <span class="token keyword">new</span>    <span class="token class-name">ConcretePrototype</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> obj1<span class="token punctuation">.</span><span class="token function">setAttr</span><span class="token punctuation">(</span><span class="token string">"Sunny"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
Prototype    obj2 <span class="token operator">=</span>    obj1<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>这种方法可作为原型模式的<strong>通用实现</strong>，它与编程语言特性无关，任何面向对象语言都可以使用这种形式来实现对原型的克隆。</p>
</li>
<li><p>java语言提供的clone()方法</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//实现克隆的Java类必须实现一个标识接口Cloneable,若没有实现该接口，则会报CloneNotSupportedException 异常</span>
<span class="token keyword">class</span>    <span class="token class-name">ConcretePrototype</span>    <span class="token keyword">implements</span>        <span class="token class-name">Cloneable</span> <span class="token punctuation">{</span>
    …… 
    <span class="token keyword">public</span>    Prototype    <span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    Object    object    <span class="token operator">=</span>    null<span class="token punctuation">;</span> 
    <span class="token keyword">try</span>    <span class="token punctuation">{</span> 　　　
    object    <span class="token operator">=</span>    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>    <span class="token keyword">catch</span>    <span class="token punctuation">(</span><span class="token class-name">CloneNotSupportedException</span>    exception<span class="token punctuation">)</span>    <span class="token punctuation">{</span> 
    System<span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Not    support    cloneable"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 　
    <span class="token punctuation">}</span> 　　
    <span class="token keyword">return</span>    <span class="token punctuation">(</span>Prototype    <span class="token punctuation">)</span>object<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> 
    …… 
<span class="token punctuation">}</span>
</code></pre>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//客户端创建原型对象和克隆对象</span>
Prototype    obj1    <span class="token operator">=</span>    <span class="token keyword">new</span>    <span class="token class-name">ConcretePrototype</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> Prototype
obj2 <span class="token operator">=</span>    obj1<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<ul>
<li><p>java语言的clone()方法满足：克隆和原型对象不是同一个，两者类型一样，</p>
<p>若对象的x的equals方法定义恰当，则x.clone().equals(x);</p>
</li>
<li><p>为了获取对象的一份拷贝，直接利用Object类的clone()方法，具体步骤如下：</p>
<ol>
<li>在派生类中覆盖基类的clone()方法，并声明为public；</li>
<li>在派生类的clone()方法中，调用super.clone()；</li>
<li>派生类需实现Cloneable接口。</li>
</ol>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="两种不同的克隆方法"><a href="#两种不同的克隆方法" class="headerlink" title="两种不同的克隆方法"></a>两种不同的克隆方法</h4><p> 浅克隆和深克隆 </p>
<p>​    主要区别：是否支持引用类型的成员变量的复制（String类型是引用类型）</p>
<h5 id="浅克隆"><a href="#浅克隆" class="headerlink" title="浅克隆"></a>浅克隆</h5><p>  在浅克隆中，当对象被复制时<strong>只复制它本身</strong>和其中包含的<strong>值类型的成员变量</strong>，而<strong>引用类型的成员对象并没有复制</strong></p>
<p>例子说明：User类中有一个Address类型的成员变量，当user_previous 的对象进行浅克隆生成user_new对象时，比较user_previous == user_new  的输出结果为false，user_previous.getAddress() == user_new.getAddress() 的输出结果为true，说明 两个User对象的Address对象为同一个对象，内存地址相同，所以进行浅克隆时引用类型的成员变量并没有进行复制。</p>
<h5 id="深克隆"><a href="#深克隆" class="headerlink" title="深克隆"></a>深克隆</h5><p>  在深克隆中，除了对象本身被复制外，对象所<strong>包含的所有成员变量也将复制</strong></p>
<pre><code>  java语言实现深克隆可以通过**序列化等方式**实现。</code></pre><p>​     序列化：序列化就是<strong>将对象写到流的过程</strong>，写到流中的对象是原有对象的一个拷贝，而原对象仍然存在于内存中。通过序列化实现的拷贝不仅可以复制对象本身，而且可以复制其引用的成员对象，因此 通过序列化将对象写到一个流中，再从流里将其读出来，可以实现深克隆。</p>
<p>​    注意点：能 够实现序列化的对象其类<strong>必须</strong>实现<strong>Serializable接口</strong></p>
<p>​    核心代码：重写clone方法，不再使用java自带的克隆机制</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> WeeklyLog <span class="token function">deepClone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span>    IOException<span class="token punctuation">,</span>ClassNotFoundExceptio<span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">//将对象写入流中</span>
    ByteArrayOutputStream    bao<span class="token operator">=</span><span class="token keyword">new</span>    <span class="token class-name">ByteArrayOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ObjectOutputStream    oos<span class="token operator">=</span><span class="token keyword">new</span>    <span class="token class-name">ObjectOutputStream</span><span class="token punctuation">(</span>bao<span class="token punctuation">)</span><span class="token punctuation">;</span>
    oos<span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">//将对象从流中取出</span>
    ByteArrayInputStream bis<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ByteArrayInputStream</span><span class="token punctuation">(</span>bao<span class="token punctuation">.</span>toByteArr        ObjectInputStream    ois<span class="token operator">=</span><span class="token keyword">new</span>        <span class="token class-name">ObjectInputStream</span><span class="token punctuation">(</span>bis<span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token keyword">return</span> <span class="token punctuation">(</span>WeeklyLog<span class="token punctuation">)</span>ois<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        
<span class="token punctuation">}</span> </code></pre>
<ul>
<li><p>原型管理器</p>
<p>原型管理器(Prototype    Manager)是<strong>将多个原型对象存储在一个集合中</strong>供客户端使用，它是一个 专门负责克隆对象的工厂，其中定义了一个集合用于存储原型对象，如果需要某个原型对象的一个克隆，可以通过复制集合中对应的原型对象来获得。在原型管理器中<strong>针对抽象原型类</strong>进行编程，以便扩展。</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//原型管理器（使用饿汉式单例实现） 确保系统中有且仅有一个 PrototypeManager对象，有利于节省系统资源，并可以更好地对原型管理器对象进行控制</span>
<span class="token keyword">class</span>        <span class="token class-name">PrototypeManager</span> <span class="token punctuation">{</span>    
    <span class="token comment" spellcheck="true">//定义一个Hashtable，使用“键值对”存储原型对象客户端可以通过Key来获取对应原型对象的克隆对象</span>
    <span class="token keyword">private</span>    Hashtable    ht<span class="token operator">=</span><span class="token keyword">new</span>    <span class="token class-name">Hashtable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span>    <span class="token keyword">static</span>    PrototypeManager pm    <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PrototypeManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">//为Hashtable增加公文对象    </span>
    <span class="token keyword">private</span>        <span class="token function">PrototypeManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                    <span class="token punctuation">{</span>
    ht<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"far"</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">FAR</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    ht<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"srs"</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">SRS</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>
    <span class="token comment" spellcheck="true">//增加新的公文对象</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addOfficialDocument</span><span class="token punctuation">(</span>String key<span class="token punctuation">,</span>OfficialDocument    doc<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
    ht<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span>doc<span class="token punctuation">)</span><span class="token punctuation">;</span>                
    <span class="token punctuation">}</span>
    <span class="token comment" spellcheck="true">//通过浅克隆获取新的公文对象    </span>
     <span class="token keyword">public</span>    OfficialDocument <span class="token function">getOfficialDocument</span><span class="token punctuation">(</span>String    key<span class="token punctuation">)</span>            <span class="token punctuation">{</span>    
           <span class="token keyword">return</span>    <span class="token punctuation">(</span><span class="token punctuation">(</span>OfficialDocument<span class="token punctuation">)</span>ht<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
       <span class="token punctuation">}</span>    
    <span class="token comment" spellcheck="true">//返回一个原型管理器</span>
      <span class="token keyword">public</span> <span class="token keyword">static</span>    PrototypeManager <span class="token function">getPrototypeManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>
            <span class="token keyword">return</span>    pm<span class="token punctuation">;</span>                        
      <span class="token punctuation">}</span>
 <span class="token punctuation">}</span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Address</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> String address<span class="token punctuation">;</span>

    <span class="token keyword">public</span> String <span class="token function">getAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> address<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setAddress</span><span class="token punctuation">(</span>String address<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>address <span class="token operator">=</span> address<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<pre class=" language-java"><code class="language-java">    User user_pervious <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user_pervious<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"张三"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user_pervious<span class="token punctuation">.</span><span class="token function">setSclass</span><span class="token punctuation">(</span><span class="token string">"一班"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        Address address <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Address</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        address<span class="token punctuation">.</span><span class="token function">setAddress</span><span class="token punctuation">(</span><span class="token string">"中心街"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user_pervious<span class="token punctuation">.</span><span class="token function">setAddress</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span><span class="token punctuation">;</span>
        User user_new <span class="token operator">=</span> user_pervious<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user_new <span class="token operator">==</span> user_pervious<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//输出false</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user_pervious<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> user_new<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//输出false</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user_pervious<span class="token punctuation">.</span><span class="token function">getSclass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> user_new<span class="token punctuation">.</span><span class="token function">getSclass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//输出true</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user_pervious<span class="token punctuation">.</span><span class="token function">getAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> user_new<span class="token punctuation">.</span><span class="token function">getAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//输出true</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>深克隆</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/**
 * @author Fan 用户类
 * @param name
 * @param sclass
 * @param address
 * @method clone 深克隆
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> String name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> String sclass<span class="token punctuation">;</span>
    <span class="token keyword">private</span> Address address<span class="token punctuation">;</span>

    <span class="token keyword">public</span> Address <span class="token function">getAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> address<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setAddress</span><span class="token punctuation">(</span>Address address<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>address <span class="token operator">=</span> address<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> String <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span>String name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> String <span class="token function">getSclass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> sclass<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setSclass</span><span class="token punctuation">(</span>String sclass<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>sclass <span class="token operator">=</span> sclass<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// 使用序列化技术实现</span>
    <span class="token keyword">public</span> User <span class="token function">deepClone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException<span class="token punctuation">,</span> ClassNotFoundException <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// 将对象写入流中</span>
        ByteArrayOutputStream bao <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ObjectOutputStream ooStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectOutputStream</span><span class="token punctuation">(</span>bao<span class="token punctuation">)</span><span class="token punctuation">;</span>
        ooStream<span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// 将对象从流中取出</span>
        ByteArrayInputStream byteArrayInputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayInputStream</span><span class="token punctuation">(</span>bao<span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ObjectInputStream oiStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectInputStream</span><span class="token punctuation">(</span>byteArrayInputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>User<span class="token punctuation">)</span> oiStream<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Address</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> String address<span class="token punctuation">;</span>

    <span class="token keyword">public</span> String <span class="token function">getAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> address<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setAddress</span><span class="token punctuation">(</span>String address<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>address <span class="token operator">=</span> address<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">test</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// TODO Auto-generated method stub</span>
        User user_pervious <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        User user_new <span class="token operator">=</span> null<span class="token punctuation">;</span>
        user_pervious<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"张三"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user_pervious<span class="token punctuation">.</span><span class="token function">setSclass</span><span class="token punctuation">(</span><span class="token string">"一班"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        Address address <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Address</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        address<span class="token punctuation">.</span><span class="token function">setAddress</span><span class="token punctuation">(</span><span class="token string">"中心街"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user_pervious<span class="token punctuation">.</span><span class="token function">setAddress</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            user_new <span class="token operator">=</span> user_pervious<span class="token punctuation">.</span><span class="token function">deepClone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// TODO: handle exception</span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"克隆失败！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user_new <span class="token operator">==</span> user_pervious<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//输出为false</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user_pervious<span class="token punctuation">.</span><span class="token function">getAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> user_new<span class="token punctuation">.</span><span class="token function">getAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//输出为false</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
</li>
</ul>
<ul>
<li><p>应用实例</p>
<ul>
<li>生活中：</li>
<li>软件中：</li>
</ul>
</li>
<li><p>优点</p>
<ul>
<li>当创建新的对象实例较为复杂时，使用原型模式可以简化对象的创建过程，通过复制一个 已有实例可以<strong>提高新实例的创建效率</strong>。</li>
<li><strong>扩展性较好，由于在原型模式中提供了抽象原型类，</strong>在客户端可以针对抽象原型类进行编 程，而将具体原型类写在配置文件中，增加或减少产品类对原有系统都没有任何影响。</li>
<li>原型模式<strong>提供了简化的创建结构，</strong>工厂方法模式常常需要有一个与产品类等级结构相同的工厂等级结构，而原型模式就不需要这样，原型模式中产品的复制是通过封装在原型类中的克隆方法实现的，无须专门的工厂类来创建产品。</li>
</ul>
</li>
<li><p>缺点</p>
<ul>
<li>需要为每一个类配备一个克隆方法，而且该克隆方法位于一个类的内部，当对已有的类进行改造时，需要修改源代码，违背了“开闭原则”。</li>
<li>实现深克隆时需要编写较为复杂的代码，而且当对象之间存在多重的嵌套引用时，为了 实现深克隆，每一层对象对应的类都必须支持深克隆，实现起来可能会比较麻烦</li>
</ul>
</li>
<li><p>注意事项</p>
<ul>
<li>创建新对象成本较大（如初始化需要占用较长的时间，占用太多的CPU资源或网络资 源），新的对象可以通过原型模式对已有对象进行复制来获得，如果是相似对象，则可以对其成员变量稍作修改。</li>
<li>如果系统要保存对象的状态，而对象的状态变化很小，或者对象本身占用内存较少时，可 以使用原型模式配合备忘录模式来实现。</li>
<li>需要避免使用分层次的工厂类来创建分层次的对象，并且类的实例对象只有一个或很少的 几个组合状态，通过复制原型对象得到新实例可能比使用构造函数创建一个新实例更加方便。</li>
</ul>
</li>
<li><p>练习：设计并实现一个用户类Customer，其中包含一个名为客户地址的成员变量，客户地址的类型为Address，用浅克隆和深克隆分别实现User对象的复制并比较这两种克隆方式的异同</p>
<p>浅克隆：</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/**
 * @author Fan 用户类
 * @param name
 * @param sclass
 * @param address
 * @method clone 浅克隆
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">implements</span> <span class="token class-name">Cloneable</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> String name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> String sclass<span class="token punctuation">;</span>
    <span class="token keyword">private</span> Address address<span class="token punctuation">;</span>

    <span class="token keyword">public</span> Address <span class="token function">getAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> address<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setAddress</span><span class="token punctuation">(</span>Address address<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>address <span class="token operator">=</span> address<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> String <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span>String name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> String <span class="token function">getSclass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> sclass<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setSclass</span><span class="token punctuation">(</span>String sclass<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>sclass <span class="token operator">=</span> sclass<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> User <span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Object object <span class="token operator">=</span> null<span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            object <span class="token operator">=</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span>User<span class="token punctuation">)</span> object<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">CloneNotSupportedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// TODO: handle exception</span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"不支持复制"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> null<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Address</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> String address<span class="token punctuation">;</span>

    <span class="token keyword">public</span> String <span class="token function">getAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> address<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setAddress</span><span class="token punctuation">(</span>String address<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>address <span class="token operator">=</span> address<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">test</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// TODO Auto-generated method stub</span>
        User user_pervious <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        
        user_pervious<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"张三"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user_pervious<span class="token punctuation">.</span><span class="token function">setSclass</span><span class="token punctuation">(</span><span class="token string">"一班"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        Address address <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Address</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        address<span class="token punctuation">.</span><span class="token function">setAddress</span><span class="token punctuation">(</span><span class="token string">"中心街"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user_pervious<span class="token punctuation">.</span><span class="token function">setAddress</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span><span class="token punctuation">;</span>
        User user_new <span class="token operator">=</span> user_pervious<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user_new <span class="token operator">==</span> user_pervious<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//输出false</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user_pervious<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> user_new<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//输出false</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user_pervious<span class="token punctuation">.</span><span class="token function">getSclass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> user_new<span class="token punctuation">.</span><span class="token function">getSclass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//输出true</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user_pervious<span class="token punctuation">.</span><span class="token function">getAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> user_new<span class="token punctuation">.</span><span class="token function">getAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//输出true</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>深克隆</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/**
 * @author Fan 用户类
 * @param name
 * @param sclass
 * @param address
 * @method clone 深克隆
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> String name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> String sclass<span class="token punctuation">;</span>
    <span class="token keyword">private</span> Address address<span class="token punctuation">;</span>

    <span class="token keyword">public</span> Address <span class="token function">getAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> address<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setAddress</span><span class="token punctuation">(</span>Address address<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>address <span class="token operator">=</span> address<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> String <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span>String name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> String <span class="token function">getSclass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> sclass<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setSclass</span><span class="token punctuation">(</span>String sclass<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>sclass <span class="token operator">=</span> sclass<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// 使用序列化技术实现</span>
    <span class="token keyword">public</span> User <span class="token function">deepClone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException<span class="token punctuation">,</span> ClassNotFoundException <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// 将对象写入流中</span>
        ByteArrayOutputStream bao <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ObjectOutputStream ooStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectOutputStream</span><span class="token punctuation">(</span>bao<span class="token punctuation">)</span><span class="token punctuation">;</span>
        ooStream<span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// 将对象从流中取出</span>
        ByteArrayInputStream byteArrayInputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayInputStream</span><span class="token punctuation">(</span>bao<span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ObjectInputStream oiStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectInputStream</span><span class="token punctuation">(</span>byteArrayInputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>User<span class="token punctuation">)</span> oiStream<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Address</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> String address<span class="token punctuation">;</span>

    <span class="token keyword">public</span> String <span class="token function">getAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> address<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setAddress</span><span class="token punctuation">(</span>String address<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>address <span class="token operator">=</span> address<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">test</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// TODO Auto-generated method stub</span>
        User user_pervious <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        User user_new <span class="token operator">=</span> null<span class="token punctuation">;</span>
        user_pervious<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"张三"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user_pervious<span class="token punctuation">.</span><span class="token function">setSclass</span><span class="token punctuation">(</span><span class="token string">"一班"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        Address address <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Address</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        address<span class="token punctuation">.</span><span class="token function">setAddress</span><span class="token punctuation">(</span><span class="token string">"中心街"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user_pervious<span class="token punctuation">.</span><span class="token function">setAddress</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            user_new <span class="token operator">=</span> user_pervious<span class="token punctuation">.</span><span class="token function">deepClone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// TODO: handle exception</span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"克隆失败！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user_new <span class="token operator">==</span> user_pervious<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//输出为false</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user_pervious<span class="token punctuation">.</span><span class="token function">getAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> user_new<span class="token punctuation">.</span><span class="token function">getAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//输出为false</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>通用实现prototype模式</p>
<p>一份个人的简历克隆成多份，简历信息包括了个人信息和工作经验;</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>designPattern<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>currencyClone<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/**
 * @author Fan
 *
 */</span>
<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Resume</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> String name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> String sex<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> age<span class="token punctuation">;</span>
    <span class="token keyword">private</span> String timeArea<span class="token punctuation">;</span>
    <span class="token keyword">private</span> String company<span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// 复制</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> Resume <span class="token function">Clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// 设置个人信息</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setPersonalInfo</span><span class="token punctuation">(</span>String name<span class="token punctuation">,</span> String sex<span class="token punctuation">,</span> <span class="token keyword">int</span> age<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>sex <span class="token operator">=</span> sex<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// 设置工作经验</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setWorkExperience</span><span class="token punctuation">(</span>String timeArea<span class="token punctuation">,</span> String company<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>timeArea <span class="token operator">=</span> timeArea<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>company <span class="token operator">=</span> company<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// 显示</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>name <span class="token operator">+</span> <span class="token string">"  "</span> <span class="token operator">+</span> sex <span class="token operator">+</span> <span class="token string">"  "</span> <span class="token operator">+</span> age<span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"工作经验: "</span> <span class="token operator">+</span> timeArea <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> company<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> String <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span>String name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> String <span class="token function">getSex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> sex<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setSex</span><span class="token punctuation">(</span>String sex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>sex <span class="token operator">=</span> sex<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> age<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setAge</span><span class="token punctuation">(</span><span class="token keyword">int</span> age<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> String <span class="token function">getTimeArea</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> timeArea<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setTimeArea</span><span class="token punctuation">(</span>String timeArea<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>timeArea <span class="token operator">=</span> timeArea<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> String <span class="token function">getCompany</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> company<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setCompany</span><span class="token punctuation">(</span>String company<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>company <span class="token operator">=</span> company<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConcreteResume</span> <span class="token keyword">extends</span> <span class="token class-name">Resume</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> Resume <span class="token function">Clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// TODO Auto-generated method stub</span>
        Resume resume <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcreteResume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resume<span class="token punctuation">.</span><span class="token function">setPersonalInfo</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getSex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resume<span class="token punctuation">.</span><span class="token function">setWorkExperience</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getTimeArea</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getCompany</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> resume<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Resume resume1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcreteResume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resume1<span class="token punctuation">.</span><span class="token function">setPersonalInfo</span><span class="token punctuation">(</span><span class="token string">"张三"</span><span class="token punctuation">,</span> <span class="token string">"男"</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resume1<span class="token punctuation">.</span><span class="token function">setWorkExperience</span><span class="token punctuation">(</span><span class="token string">"2014-2019"</span><span class="token punctuation">,</span> <span class="token string">"深圳腾讯股份有限公司"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Resume resume2 <span class="token operator">=</span> resume1<span class="token punctuation">.</span><span class="token function">Clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resume1<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resume2<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>resume1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>resume2<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment" spellcheck="true">/*输出内容：最后打印的两行信息说明不是同一个对象
张三  男  26
工作经验: 2014-2019 深圳腾讯股份有限公司
张三  男  26
工作经验: 2014-2019 深圳腾讯股份有限公司
com.designPattern.prototype.currencyClone.ConcreteResume@15db9742
com.designPattern.prototype.currencyClone.ConcreteResume@6d06d69c*/</span>
</code></pre>
</li>
</ul>
<h3 id="建造者模式"><a href="#建造者模式" class="headerlink" title="建造者模式"></a>建造者模式</h3><ul>
<li><p>设计模式的意图</p>
<p>如何将一个由<strong>多个部件组装</strong>的物品组装起来并返回用户。建造者模式为客户端返回的<strong>不是</strong>一个简单的产品，<strong>而是一个由多个部件组成的复杂产品</strong>。</p>
</li>
<li><p>解决什么问题，什么时候使用该设计模式</p>
<p>将<strong>客户端</strong>与包含多个组成部分（或部件）的复杂对象的<strong>创建过程</strong>分离，客户端无须知道复杂对象的内部组成部分与装配方式，只需要知道所需 建造者的类型即可。</p>
<p>例如：游戏角色是一个复杂对象，它包含性别、脸型等多个组 成部分，不同的游戏角色其组成部分有所差异，无论是何种造型的游戏角色，它的<strong>创建步骤都大同小异</strong>，都需要<strong>逐步创建</strong>其组成部分，再将各<strong>组成部分</strong>装配成<strong>一个完整</strong>的游戏角色。</p>
</li>
<li><p>怎样解决</p>
<p>关注如何一步一步创建一个的复杂对象，不同的具体建造者定义了不同的创建过程，且具体建造者相互独立，增加新的建造者非常方便，无须修改已有代码，系统具有较好的扩展性。</p>
<p>建造者模式的定义：将一个复杂对象的构建与它的表示分离，使得同样的构建过程可 以创建不同的表示。建造者模式是一种对象创建型模式。</p>
</li>
<li><p>结构图</p>
<p><img src="/posts/911124684/builderConstructionImg.PNG" alt="builderConstruction"></p>
<p>Builder（抽象建造者）：它为创建一个产品Product对象的各个部件指定抽象接口，在该接 口中一般声明两类方法，<strong>一类方法是buildPartX()</strong>，它们用于创建复杂对象的各个部件；<strong>另一 类方法是getResult()</strong>，它们用于返回复杂对象。Builder既可以是抽象类，也可以是接口</p>
<p>ConcreteBuilder（具体建造者）：它实现了Builder接口，<strong>实现各个部件的具体构造和装配方法</strong>，定义并明确它所创建的复杂对象，也可以提供一个方法返回创建好的复杂产品对象。</p>
<p>Product（产品角色）：它是<strong>被构建的复杂对象</strong>，包含多个组成部件，具体建造者创建该产品 的内部表示并定义它的装配过程。</p>
<p>Director（指挥者）：指挥者又称为导演类，它<strong>负责安排复杂对象的建造次序</strong>，指挥者与抽 象建造者之间存在关联关系，可以在<strong>其construct()建造方法中调用建造者对象的部件构造与装配方法</strong>，完成复杂对象的建造。客户端一般只需要与指挥者进行交互，在客户端确定具体建 造者的类型，并实例化具体建造者对象（也可以通过配置文件和反射机制），然后通过指挥 者类的构造函数或者Setter方法将该对象传入指挥者类中</p>
</li>
<li><p>关键代码</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//复杂对象类</span>
    <span class="token keyword">class</span>    <span class="token class-name">Product</span>        <span class="token punctuation">{</span>                            
    <span class="token keyword">private</span>        String    partA<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//定义部件，部件可以是任意类型，包括值类型和引用类型</span>
    <span class="token keyword">private</span>        String    partB<span class="token punctuation">;</span>
    <span class="token keyword">private</span>        String    partC<span class="token punctuation">;</span>    
    <span class="token comment" spellcheck="true">//partA的Getter方法和Setter方法省略    </span>
    <span class="token comment" spellcheck="true">//partB的Getter方法和Setter方法省略    </span>
    <span class="token comment" spellcheck="true">//partC的Getter方法和Setter方法省略</span>
<span class="token punctuation">}</span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//抽象建造者类中定义了产品的创建方法和返回方法，</span>
<span class="token keyword">abstract</span>    <span class="token keyword">class</span>    <span class="token class-name">Builder</span>    <span class="token punctuation">{</span>    
<span class="token comment" spellcheck="true">//创建产品对象                        </span>
    <span class="token keyword">protected</span> Product    product<span class="token operator">=</span><span class="token keyword">new</span>    <span class="token class-name">Product</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span>    <span class="token keyword">abstract</span>    <span class="token keyword">void</span>    <span class="token function">buildPartA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token keyword">public</span>    <span class="token keyword">abstract</span>    <span class="token keyword">void</span>    <span class="token function">buildPartB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token keyword">public</span>    <span class="token keyword">abstract</span>    <span class="token keyword">void</span>    <span class="token function">buildPartC</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">//返回产品对象</span>
    <span class="token keyword">public</span>    Product    <span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>                                        <span class="token keyword">return</span> product<span class="token punctuation">;</span>                            
    <span class="token punctuation">}</span>
    <span class="token punctuation">}</span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//指挥者类Director</span>
<span class="token keyword">class</span>    <span class="token class-name">Director</span>    <span class="token punctuation">{</span>
    <span class="token keyword">private</span>    Builder    builder<span class="token punctuation">;</span>
    <span class="token keyword">public</span>    <span class="token function">Director</span><span class="token punctuation">(</span>Builder builder<span class="token punctuation">)</span>    <span class="token punctuation">{</span>                            <span class="token keyword">this</span><span class="token punctuation">.</span>builder<span class="token operator">=</span>builder<span class="token punctuation">;</span>                    
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span>    <span class="token keyword">void</span> <span class="token function">setBuilder</span><span class="token punctuation">(</span>Builder    builder<span class="token punctuation">)</span>    <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>builder<span class="token operator">=</span>builer<span class="token punctuation">;</span>                    
        <span class="token punctuation">}</span>
    <span class="token comment" spellcheck="true">//产品构建与组装方法                </span>
    <span class="token keyword">public</span>    Product    <span class="token function">construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>
    builder<span class="token punctuation">.</span><span class="token function">buildPartA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    builder<span class="token punctuation">.</span><span class="token function">buildPartB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    builder<span class="token punctuation">.</span><span class="token function">buildPartC</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                            <span class="token keyword">return</span>    builder<span class="token punctuation">.</span><span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>Director类主要有两个作用：一方面它<strong>隔离 了客户与创建过程</strong>；另一方面它<strong>控制产品的创建过程</strong>，包括某个buildPartX()方法是否被调用 以及多个buildPartX()方法调用的先后次序等。</p>
<p>指挥者针对抽象建造者编程，客户端只需要知道具体建造者的类型，即可通过指挥者类调用建造者的相关方法，返回一个完整的产品对 象。</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//客户端</span>
…… Builder        builder    <span class="token operator">=</span>    <span class="token keyword">new</span>    <span class="token class-name">ConcreteBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//可通过配置文件实现</span>
Director    director    <span class="token operator">=</span>    <span class="token keyword">new</span>        <span class="token class-name">Director</span><span class="token punctuation">(</span>builder<span class="token punctuation">)</span><span class="token punctuation">;</span>
Product    product    <span class="token operator">=</span>    director<span class="token punctuation">.</span><span class="token function">construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
……
</code></pre>
</li>
<li><p>对于Director的进一步讨论</p>
<p>1.省略Director，将Director与抽象建造者Builder合并，在Builder 中提供逐步构建复杂产品对象的construct()方法，直接在construct() 方法中调用buildPartX()方法。</p>
<p>​     注意：  对Director类的省略方式都不影响系统的灵活性和可扩展性，同时还简化了系统结 构，但加重了抽象建造者类的职责，如果construct()方法较为复杂，待构建产品的组成部分较 多，建议还是将construct()方法单独封装在Director中，这样做更符合“单一职责原则”。</p>
<p>2.钩子方法的引入</p>
<p>建造者模式可以通过Director类来更加<strong>精细地控制产品的创建过程</strong>，例如增加一类称之为钩子方法(HookMethod)的特殊方法来控制是否对某个 buildPartX()的调用。</p>
<p>钩子方法的返回类型通常为boolean类型，方法名一般为isXXX()，钩子方法定义在<strong>抽象建造者类</strong>（Builder类）中</p>
<p>通过引入钩子方 法，我们可以在Director中对复杂产品的构建进行精细的控制，不仅指定buildPartX()方法的执行顺序，还可以控制是否需要执行某个buildPartX()方法。</p>
</li>
<li><p>应用实例</p>
<ul>
<li>生活中：一辆汽车的组装  ，套餐的组合</li>
<li>软件中：游戏角色的模型的创建</li>
</ul>
</li>
<li><p>优点</p>
<ul>
<li>在建造者模式中，客户端不必知道产品内部组成的细节，将产品本身与产品的创建过程解 耦，使得相同的创建过程可以创建不同的产品对象</li>
<li>​    每一个具体建造者都相对独立，而与其他的具体建造者无关，因此可以很方便地替换具体 建造者或增加新的具体建造者，用户使用不同的具体建造者即可得到不同的产品对象。由于 指挥者类针对抽象建造者编程，增加新的具体建造者无须修改原有类库的代码，系统扩展方 便，符合“开闭原则”</li>
<li>更加精细地控制产品的创建过程。将复杂产品的创建步骤分解在不同的方法中，使得 创建过程更加清晰，也更方便使用程序来控制创建过程</li>
</ul>
</li>
<li><p>缺点</p>
<ul>
<li>建造者模式所创建的产品一般具有较多的<strong>共同点</strong>，其<strong>组成部分相似</strong>，如果产品之间的<strong>差异性很大</strong>，例如很多组成部分都不相同，不适合使用建造者模式，因此其使用范围受到一定的 限制。</li>
<li>如果产品的内部变化复杂，可能会导致需要定义很多具体建造者类来实现这种变化，导致 系统变得很庞大，增加系统的理解难度和运行成本。</li>
</ul>
</li>
<li><p>注意事项</p>
<ul>
<li><p>需要生成的产品对象有复杂的内部结构，这些产品对象通常<strong>包含多个成员属性</strong>。</p>
</li>
<li><p>需要生成的产品对象的属性相互依赖，<strong>需要指定其生成顺序</strong>。</p>
</li>
<li><p>对象的创建过程独立于创建该对象的类。在建造者模式中通过引入了指挥者类，将创建过 程封装在指挥者类中，而不在建造者类和客户类中。</p>
</li>
<li><p>隔离复杂对象的创建和使用，并使得<strong>相同的创建过程</strong>可以创建<strong>不同的产品</strong>。</p>
</li>
</ul>
</li>
<li><p>练习：Sunny软件公司欲开发一个视频播放软件，为了给用户使用提供方便，该播放软件提供多种界面显示模式，如完整模式、精简模式、记忆模式、网络模式等。在不同的显示模式 下主界面的组成元素有所差异，如在完整模式下将显示菜单、播放列表、主窗口、控制条等，在精简模式下只显示主窗口和控制条，而在记忆模式下将显示主窗口、控制条、 收藏列表等。尝试使用建造者模式设计该软件。</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/**
 * @author Fan 主窗口
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainWindows</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token function">MainWindows</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"显示主窗口"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/**
 * @author Fan 菜单显示
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MenuView</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token function">MenuView</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"显示主菜单"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/**
 * @author Fan 播放列表
 */</span>
<span class="token keyword">class</span> <span class="token class-name">PlayList</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token function">PlayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"显示播放列表"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/**
 * @author Fan 控制条
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ControlBar</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token function">ControlBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"显示控制条"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/**
 * @author Fan 收藏列表
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CollectList</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token function">CollectList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"显示收藏列表"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/**
 * @author Fan 视频播放软件
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">VideoPlayer</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> MenuView menuView<span class="token punctuation">;</span>
    <span class="token keyword">private</span> MainWindows mainWindows<span class="token punctuation">;</span>
    <span class="token keyword">private</span> PlayList playList<span class="token punctuation">;</span>
    <span class="token keyword">private</span> ControlBar controlBar<span class="token punctuation">;</span>
    <span class="token keyword">private</span> CollectList collectList<span class="token punctuation">;</span>

    <span class="token keyword">public</span> CollectList <span class="token function">getCollectList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> collectList<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setCollectList</span><span class="token punctuation">(</span>CollectList collectList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>collectList <span class="token operator">=</span> collectList<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> MenuView <span class="token function">getMenuView</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> menuView<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMenuView</span><span class="token punctuation">(</span>MenuView menuView<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>menuView <span class="token operator">=</span> menuView<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> MainWindows <span class="token function">getMainView</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> mainWindows<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMainView</span><span class="token punctuation">(</span>MainWindows mainView<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>mainWindows <span class="token operator">=</span> mainView<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> PlayList <span class="token function">getPlayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> playList<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setPlayList</span><span class="token punctuation">(</span>PlayList playList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>playList <span class="token operator">=</span> playList<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> ControlBar <span class="token function">getControlBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> controlBar<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setControlBar</span><span class="token punctuation">(</span>ControlBar controlBar<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>controlBar <span class="token operator">=</span> controlBar<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/**
 * @author Fan 视频播放build
 */</span>
<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">VideoPlayerBuild</span> <span class="token punctuation">{</span>
    VideoPlayer videoPlayer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VideoPlayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">buildMainWindows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">buildMenuView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">buildPlayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">buildControlBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">buildCollectList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> VideoPlayer <span class="token function">construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">buildMainWindows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isMenuView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">buildMenuView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isPlayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">buildPlayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">buildControlBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isCollectList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">buildCollectList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> videoPlayer<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> Boolean <span class="token function">isMenuView</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> Boolean <span class="token function">isPlayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> Boolean <span class="token function">isCollectList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/**
 * @author Fan 完整模式
 *将所有组件显示
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CompleteVideoPlayerBuild</span> <span class="token keyword">extends</span> <span class="token class-name">VideoPlayerBuild</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">buildMainWindows</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// TODO Auto-generated method stub</span>
        videoPlayer<span class="token punctuation">.</span><span class="token function">setMainView</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MainWindows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">buildMenuView</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// TODO Auto-generated method stub</span>
        videoPlayer<span class="token punctuation">.</span><span class="token function">setMenuView</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MenuView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">buildPlayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// TODO Auto-generated method stub</span>
        videoPlayer<span class="token punctuation">.</span><span class="token function">setPlayList</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PlayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">buildControlBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// TODO Auto-generated method stub</span>
        videoPlayer<span class="token punctuation">.</span><span class="token function">setControlBar</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ControlBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">buildCollectList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// TODO Auto-generated method stub</span>
        videoPlayer<span class="token punctuation">.</span><span class="token function">setCollectList</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CollectList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> Boolean <span class="token function">isMenuView</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// TODO Auto-generated method stub</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> Boolean <span class="token function">isPlayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// TODO Auto-generated method stub</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> Boolean <span class="token function">isCollectList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// TODO Auto-generated method stub</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/**
 * @author Fan 精简模式
 * 只显示 主窗口和控制条
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SimpleVideoPlayerBuild</span> <span class="token keyword">extends</span> <span class="token class-name">VideoPlayerBuild</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">buildMainWindows</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// TODO Auto-generated method stub</span>
        videoPlayer<span class="token punctuation">.</span><span class="token function">setMainView</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MainWindows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">buildMenuView</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// TODO Auto-generated method stub</span>
        videoPlayer<span class="token punctuation">.</span><span class="token function">setMenuView</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MenuView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">buildPlayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// TODO Auto-generated method stub</span>
        videoPlayer<span class="token punctuation">.</span><span class="token function">setPlayList</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PlayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">buildControlBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// TODO Auto-generated method stub</span>
        videoPlayer<span class="token punctuation">.</span><span class="token function">setControlBar</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ControlBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">buildCollectList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// TODO Auto-generated method stub</span>
        videoPlayer<span class="token punctuation">.</span><span class="token function">setCollectList</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CollectList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> Boolean <span class="token function">isMenuView</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// TODO Auto-generated method stub</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> Boolean <span class="token function">isPlayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// TODO Auto-generated method stub</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> Boolean <span class="token function">isCollectList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// TODO Auto-generated method stub</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/**
 * @author Fan 记忆模式
 *显示 主窗口 ，控制条和收藏列表
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MemoryVideoPlayerBuild</span> <span class="token keyword">extends</span> <span class="token class-name">VideoPlayerBuild</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">buildMainWindows</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// TODO Auto-generated method stub</span>
        videoPlayer<span class="token punctuation">.</span><span class="token function">setMainView</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MainWindows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">buildMenuView</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// TODO Auto-generated method stub</span>
        videoPlayer<span class="token punctuation">.</span><span class="token function">setMenuView</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MenuView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">buildPlayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// TODO Auto-generated method stub</span>
        videoPlayer<span class="token punctuation">.</span><span class="token function">setPlayList</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PlayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">buildControlBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// TODO Auto-generated method stub</span>
        videoPlayer<span class="token punctuation">.</span><span class="token function">setControlBar</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ControlBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">buildCollectList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// TODO Auto-generated method stub</span>
        videoPlayer<span class="token punctuation">.</span><span class="token function">setCollectList</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CollectList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> Boolean <span class="token function">isMenuView</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// TODO Auto-generated method stub</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> Boolean <span class="token function">isPlayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// TODO Auto-generated method stub</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> Boolean <span class="token function">isCollectList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// TODO Auto-generated method stub</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">XMLUtil</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 该方法用于从XML配置文件中提取具体类类名，并返回一个实例对象</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> Object <span class="token function">getBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// 创建DOM文档对象</span>
            DocumentBuilderFactory dFactory <span class="token operator">=</span> DocumentBuilderFactory<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            DocumentBuilder builder <span class="token operator">=</span> dFactory<span class="token punctuation">.</span><span class="token function">newDocumentBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            Document doc<span class="token punctuation">;</span>
            doc <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">"src//com//designPattern//build//config.xml"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment" spellcheck="true">// 获取包含类名的文本结点</span>
            NodeList nl <span class="token operator">=</span> doc<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">"className"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            Node classNode <span class="token operator">=</span> nl<span class="token punctuation">.</span><span class="token function">item</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFirstChild</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            String cName <span class="token operator">=</span> classNode<span class="token punctuation">.</span><span class="token function">getNodeValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment" spellcheck="true">// 通过类名生成实例对象并将其返回</span>
            Class <span class="token class-name">c</span> <span class="token operator">=</span> Class<span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>cName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            Object obj <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> obj<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> null<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<pre class=" language-xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0"?></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>config</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>className</span><span class="token punctuation">></span></span>com.designPattern.build.MemoryVideoPlayerBuild<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>className</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>config</span><span class="token punctuation">></span></span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        VideoPlayerBuild videoPlayerBuild<span class="token punctuation">;</span>
        videoPlayerBuild <span class="token operator">=</span> <span class="token punctuation">(</span>VideoPlayerBuild<span class="token punctuation">)</span> XMLUtil<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        VideoPlayer videoPlayer <span class="token operator">=</span> videoPlayerBuild<span class="token punctuation">.</span><span class="token function">construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
</li>
</ul>
<h2 id="七个结构型模式"><a href="#七个结构型模式" class="headerlink" title="七个结构型模式"></a>七个结构型模式</h2><h3 id="适配器模式"><a href="#适配器模式" class="headerlink" title="适配器模式"></a>适配器模式</h3><ul>
<li><p>意图： 解决不兼容结构问题 ；通过增加一个类似于电源适配器一样的适配器角色，协调两个原本不兼容的结构。</p>
</li>
<li><p>概述：将一个接口转换成客户希望的另一个接口，使接口不兼容的那 些类可以一起工作，其别名为包装器(Wrapper)。适配器模式既可以作为类结构型模式，也可以作为对象结构型模式。</p>
</li>
<li><p>适配器的实现 ：把客户类的请求转化为对适配者的相应接口的调用。</p>
<p>简单的说：当客户类调用适配器的方法时，在适配器类的内部将调用适配者类的方法，而这个过程对客户类是透明的，客户类<strong>并不直接</strong>访问适配者类。因此， 适配器让那些由于接口不兼容而不能交互的类可以一起工作。</p>
</li>
</ul>
<p>适配器分为对象适配器和类适配器</p>
<h4 id="对象适配器（常用）"><a href="#对象适配器（常用）" class="headerlink" title="对象适配器（常用）"></a>对象适配器（常用）</h4><p>​    适配器与适配者之间是<strong>关联关系</strong></p>
<pre><code>-  Target（目标抽象类）：目标抽象类定义客户所需接口，可以是一个抽象类或接口，也可以 是具体类。
-  Adapter（适配器类）：适配器可以调用另一个接口，作为一个**转换器**，对Adaptee和Target进行适配，适配器类是适配器模式的**核心**，在对象适配器中，它通过**继承Target**并**关联**一个 Adaptee对象使二者产生联系。
-  Adaptee（适配者类）：适配者即被适配的角色，它定义了一个已经存在的接口，这个接口需要适配，适配者类一般是**一个具体类**，包含了客户希望使用的业务方法，在某些情况下可能没有适配者类的源代码。</code></pre><p>关键代码：</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">class</span>    <span class="token class-name">Adapter</span>    <span class="token keyword">extends</span>    <span class="token class-name">Target</span>    <span class="token punctuation">{</span>
    <span class="token keyword">private</span>    Adaptee    adaptee<span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">//维持一个对适配者对象的引用        </span>
    <span class="token keyword">public</span>    <span class="token function">Adapter</span><span class="token punctuation">(</span>Adaptee    adaptee<span class="token punctuation">)</span>    <span class="token punctuation">{</span>                        <span class="token keyword">this</span><span class="token punctuation">.</span>adaptee<span class="token operator">=</span>adaptee<span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>        
    <span class="token keyword">public</span>    <span class="token keyword">void</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>
            adaptee<span class="token punctuation">.</span><span class="token function">specificRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//转发调用                    }</span>
    <span class="token punctuation">}</span></code></pre>
<p>优点：</p>
<ul>
<li>一个对象适配器可以把多个不同的适配者适配到同一个目标</li>
<li>可以适配一个适配者的子类，由于适配器和适配者之间是关联关系，根据“里氏代换原则”，适配者的子类也可通过该适配器进行适配。</li>
</ul>
<p>缺点：</p>
<ul>
<li>与类适配器模式相比，要在适配器中置换适配者类的某些方法比较麻烦。如果一定要置换掉 适配者类的一个或多个方法，可以先做一个适配者类的子类，将适配者类的方法置换掉，然 后再把适配者类的子类当做真正的适配者进行适配，实现过程较为复杂。</li>
</ul>
<h4 id="类适配器"><a href="#类适配器" class="headerlink" title="类适配器"></a>类适配器</h4><p>适配器与适配者之间是<strong>继承关系</strong></p>
<p>根据类适配器模式结构图，适配器类<strong>实现</strong>了抽象目标类接口Target，并<strong>继承</strong>适配者类，在 配器类的request()方法中调用所继承的适配者类的specificRequest()方法，实现了适配</p>
<p>关键代码：</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">class</span>    <span class="token class-name">Adapter</span>    <span class="token keyword">extends</span>    <span class="token class-name">Adaptee</span>    <span class="token keyword">implements</span>    <span class="token class-name">Target</span>    <span class="token punctuation">{</span>
    <span class="token keyword">public</span>    <span class="token keyword">void</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>
        <span class="token function">specificRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
 <span class="token punctuation">}</span></code></pre>
<p>注意：由于Java不支持多重类继承，因此类适配器的使用受到很多限制，例如如果目标抽象类Target不是接口，而是一个类，就无法使用类适配器；此外，如果适配者Adapter为最终 (Final)类，也无法使用类适配器。<strong>所以Target目标类必须是一个接口</strong></p>
<p>优点：</p>
<ul>
<li>由于适配器类是适配者类的子类，因此可以在适配器类中置换一些适配者的方法，使得适配 器的灵活性更强</li>
</ul>
<p>缺点：</p>
<ul>
<li>对于Java、C#等不支持多重类继承的语言，一次最多只能适配一个适配者类，不能同时适 配多个适配者；</li>
<li>适配者类不能为最终类，如在Java中不能为final类，C#中不能为sealed类；</li>
<li>在Java、C#等语言中，类适配器模式中的<strong>目标抽象类只能为接口</strong>，不能为类，其使用有一 定的局限性。</li>
</ul>
<h4 id="双向适配器（前提：对象适配器）"><a href="#双向适配器（前提：对象适配器）" class="headerlink" title="双向适配器（前提：对象适配器）"></a>双向适配器（前提：对象适配器）</h4><p>​    <strong>对象适配器的使用过程中</strong>，如果在适配器中<strong>同时包含对目标类和适配者类的引用</strong>，适配者 可以通过它调用目标类中的方法，目标类也可以通过它调用适配者类中的方法，那么该适配器就是一个双向适配器</p>
<p>关键代码</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">class</span>    <span class="token class-name">Adapter</span>    <span class="token keyword">implements</span>    <span class="token class-name">Target</span><span class="token punctuation">,</span>Adaptee    <span class="token punctuation">{</span>    
    <span class="token comment" spellcheck="true">//同时维持对抽象目标类和适配者的引用</span>
    <span class="token keyword">private</span>    Target    target<span class="token punctuation">;</span>    
    <span class="token keyword">private</span>    Adaptee    adaptee<span class="token punctuation">;</span>
    <span class="token keyword">public</span>    <span class="token function">Adapter</span><span class="token punctuation">(</span>Target    target<span class="token punctuation">)</span>    <span class="token punctuation">{</span>                            <span class="token keyword">this</span><span class="token punctuation">.</span>target    <span class="token operator">=</span>    target<span class="token punctuation">;</span>                    <span class="token punctuation">}</span>        
    <span class="token keyword">public</span>    <span class="token function">Adapter</span><span class="token punctuation">(</span>Adaptee    adaptee<span class="token punctuation">)</span>    <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>adaptee    <span class="token operator">=</span>    adaptee<span class="token punctuation">;</span>                        <span class="token punctuation">}</span>        
    <span class="token keyword">public</span>    <span class="token keyword">void</span>    <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>                                adaptee<span class="token punctuation">.</span><span class="token function">specificRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>        
    <span class="token keyword">public</span>    <span class="token keyword">void</span>    <span class="token function">specificRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>    
        target<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>    
 <span class="token punctuation">}</span></code></pre>
<h4 id="缺省适配器（单口适配器接口）"><a href="#缺省适配器（单口适配器接口）" class="headerlink" title="缺省适配器（单口适配器接口）"></a>缺省适配器（单口适配器接口）</h4><p>缺省适配器模式：当<strong>不需要</strong>实现一个接口所提供的<strong>所有</strong>方法时，可先设计一个抽象类实现该接口，并为接口中每个方法提供一个默认实现（空方法），那么该抽象类的子类可以<strong>选择性地覆盖</strong>父类的某些方法来实现需求，它<strong>适用于不想使用一个接口中的所有方法</strong>的情况</p>
<ul>
<li>ServiceInterface（适配者接口）：它是一个接口，通常在该接口中声明了大量的方法。</li>
<li>AbstractServiceClass（缺省适配器类）：它是缺省适配器模式的核心类，使用空方法的形式 实现了在ServiceInterface接口中声明的方法。通常将它定义为抽象类，因为对它进行实例化没 有任何意义。</li>
<li>ConcreteServiceClass（具体业务类）：它是缺省适配器类的子类，在没有引入适配器之前， 它需要实现适配者接口，因此需要实现在适配者接口中定义的所有方法，而对于一些无须使用的方法也不得不提供空实现。在<strong>有了缺省适配器之后，可以直接继承该适配器类，根据需 要有选择性地覆盖在适配器类中定义的方法</strong>。</li>
</ul>
<p>练习：Sunny软件公司OA系统需要提供一个加密模块，将用户机密信息（如口令、邮箱等）加密之后再存储在数据库中，系统已经定义好了数据库操作类。为了提高开发效率，现需要重用已有的加密算法，这些算法封装在一些由第三方提供的类中，有些甚至没有源代码。试使用适配器模式设计该加密模块，实现在不修改现有类的基础上重用第三方加密 方法</p>
<p>下列代码对象适配器：</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//适配者</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EncryptionAlgorithm</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">encryptionAlgorithm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"调用加密算法"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//目标</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserMessageEncryptionModel</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 对邮箱的加密</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">encryptionEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// 对密码加密</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">encryptionPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//适配器</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EncryptionAlgorithmAdapter</span> <span class="token keyword">implements</span> <span class="token class-name">UserMessageEncryptionModel</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> EncryptionAlgorithm encryptionAlgorithm<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">EncryptionAlgorithmAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        encryptionAlgorithm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EncryptionAlgorithm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">encryptionEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// TODO Auto-generated method stub</span>
        encryptionAlgorithm<span class="token punctuation">.</span><span class="token function">encryptionAlgorithm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"对邮箱已加密"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">encryptionPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// TODO Auto-generated method stub</span>
        encryptionAlgorithm<span class="token punctuation">.</span><span class="token function">encryptionAlgorithm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"对密码已加密"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<pre><code>public class Client {
    public static void main(String[] args) {
        UserMessageEncryptionModel umem;
        umem = (UserMessageEncryptionModel)             XMLUtil.getAdapterType();
        umem.encryptionEmail();
        umem.encryptionPassword();
    }
}</code></pre><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">XMLUtil</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> Object <span class="token function">getAdapterType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            DocumentBuilderFactory documentBuilderFactory <span class="token operator">=</span> DocumentBuilderFactory<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            DocumentBuilder documentBuilder <span class="token operator">=</span> documentBuilderFactory<span class="token punctuation">.</span><span class="token function">newDocumentBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            Document document <span class="token operator">=</span> documentBuilder<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">"lib/config.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            NodeList nodeList <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">"adapterType"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            Node classNode <span class="token operator">=</span> nodeList<span class="token punctuation">.</span><span class="token function">item</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFirstChild</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            String className <span class="token operator">=</span> classNode<span class="token punctuation">.</span><span class="token function">getNodeValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            Class<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span> cName <span class="token operator">=</span> Class<span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"com.designPattern.adapter."</span> <span class="token operator">+</span> className<span class="token punctuation">)</span><span class="token punctuation">;</span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>cName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            Object object <span class="token operator">=</span> cName<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> object<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// TODO: handle exception</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> null<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre>
<pre class=" language-xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>config</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>adapterType</span><span class="token punctuation">></span></span>EncryptionAlgorithmAdapter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>adapterType</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>config</span><span class="token punctuation">></span></span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//输出结果</span>
调用加密算法
对邮箱已加密
调用加密算法
对密码已加密</code></pre>
<h3 id="桥接模式"><a href="#桥接模式" class="headerlink" title="桥接模式"></a>桥接模式</h3><ul>
<li><p>意图：</p>
<p>处理一个类中有两个或多个以上不同的独立变化的维度</p>
</li>
<li><p>解决什么问题，什么时候使用该设计模式</p>
<p>采用多层继承结构方法处理一个具有多个维度变化的类，导致系统的类个数极剧增加</p>
<p>处理一个具有多个维度变化的类添加新的某一维度的对象时将需要增加大量的具体类，扩展麻烦</p>
</li>
<li><p>怎样解决</p>
<p>​    将一个类中两个独立变化的维度分离，使它们可以独立扩展，增加某一个维度的对象都对另一个维度不造成任何影响，让系统更加符合单一职责原则。</p>
<p>​    与多层继承方案不同，它将两个独立变化的维度设计为<strong>两个独立的继承等级结构</strong>， 并且在抽象层<strong>建立一个抽象关联</strong>，该关联关系类似一条连接两个独立继承结构的桥，故名桥接模式。</p>
<p>​    桥接模式：：将抽象部分与它的实现部分分离，使它们都可以独立地变化。它是 一种对象结构型模式，又称为柄体(Handle and Body)模式或接口(Interface)模式。</p>
</li>
<li><p>结构图</p>
<p><strong>Abstraction（抽象类）</strong>：用于定义抽象类的接口，它<strong>一般是抽象类</strong>而不是接口，其中定义了 一个Implementor（实现类接口）类型的对象并可以维护该对象，它与Implementor之间具有<strong>关联关系</strong>，它既可以包含抽象业务方法，也可以包含具体业务方法。</p>
<p><strong>RefinedAbstraction（扩充抽象类）</strong>：扩充由Abstraction定义的接口，通常情况下它不再是抽象类而是具体类，它实现了在Abstraction中声明的抽象业务方法，在RefinedAbstraction中可以 调用在Implementor中定义的业务方法。</p>
<p><strong>Implementor（实现类接口）</strong>：定义实现类的接口，这个接口不一定要与Abstraction的接口完 全一致，事实上这两个接口可以完全不同，一般而言，Implementor接口仅提供基本操作，而 Abstraction定义的接口可能会做更多更复杂的操作。Implementor接口对这些基本操作进行了声 明，而具体实现交给其子类。通过关联关系，在Abstraction中不仅拥有自己的方法，还可以调 用到Implementor中定义的方法，使用关联关系来替代继承关系。</p>
<p><strong>ConcreteImplementor（具体实现类）</strong>：具体实现Implementor接口，在不同的 ConcreteImplementor中提供基本操作的不同实现，在程序运行时，ConcreteImplementor对象将 替换其父类对象，提供给抽象类具体的业务操作方法。</p>
</li>
<li><p>在桥接模式中的设计原则的思想：</p>
<p>“单一职责原则”、“开闭原则”、“合成复用原则”、“里氏代换原则”、“依赖倒转原则”等</p>
</li>
<li><p>使用该模式的注意点：</p>
<ol>
<li><p>需要识别出一个类所具有的两个或多个的独立变化的维度</p>
</li>
<li><p><strong>将维度设计为两个或多个独立的等级结构，为不同的维度都提供抽象层，建立抽象耦合</strong></p>
<p>通常情况下，我们将具有两个独立变化维度的类的一些普通业务方法和与之关系最密切的维度设计为“抽象 ”层次结构（抽象部分），而将另一个维度设计为“实现类”层次结构（实现部分）。</p>
<p>例如：对于毛笔而言，由于型号是其固有的维度，因此可以设计一个抽象的毛笔类，在该类中声明 并部分实现毛笔的业务方法，而将各种型号的毛笔作为其子类；颜色是毛笔的另一个维度， 由于它与毛笔之间存在一种“设置”的关系，因此我们可以提供一个抽象的颜色接口，而将具体的颜色作为实现该接口的子类。因此，型号可认为是毛笔的抽象部分，而颜色是毛笔的实现 部分</p>
</li>
</ol>
</li>
<li><p>关键代码</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//对于“实现部分”维度  </span>
<span class="token keyword">interface</span>    <span class="token class-name">Implementor</span>    <span class="token punctuation">{</span>    
    <span class="token keyword">public</span>    <span class="token keyword">void</span>    <span class="token function">operationImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//“抽象部分”维度</span>
<span class="token keyword">abstract</span>    <span class="token keyword">class</span>    <span class="token class-name">Abstraction</span>    <span class="token punctuation">{</span>
    <span class="token keyword">protected</span>    Implementor    impl<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//定义实现类接口对象        </span>
    <span class="token keyword">public</span>    <span class="token keyword">void</span>    <span class="token function">setImpl</span><span class="token punctuation">(</span>Implementor    impl<span class="token punctuation">)</span>    <span class="token punctuation">{</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>impl<span class="token operator">=</span>impl<span class="token punctuation">;</span>                        
    <span class="token punctuation">}</span>        
        <span class="token keyword">public</span>    <span class="token keyword">abstract</span>    <span class="token keyword">void</span>    <span class="token function">operation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//声明抽象业务方法        </span>
<span class="token punctuation">}</span>
</code></pre>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//定义了一个实现类接口类型的成员对象impl，再通过注入的方式给该对象赋值，一般将该对象的可见性定义为protected，以便在其子类中访问Implementor的方法，其子类一般称为扩充抽象类或细化抽象类(RefinedAbstraction)</span>
<span class="token keyword">class</span> <span class="token class-name">RefinedAbstraction</span>    <span class="token keyword">extends</span>    <span class="token class-name">Abstraction</span>    <span class="token punctuation">{</span>
    <span class="token keyword">public</span>    <span class="token keyword">void</span>    <span class="token function">operation</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>    
    <span class="token comment" spellcheck="true">//业务代码                        </span>
            impl<span class="token punctuation">.</span><span class="token function">operationImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//调用实现类的方法    </span>
    <span class="token comment" spellcheck="true">//业务代码                    </span>
     <span class="token punctuation">}</span>        
 <span class="token punctuation">}</span></code></pre>
</li>
<li><p>适配器模式与桥接模式的联用</p>
<p>桥接模式和适配器模式用于设计的不同阶段，桥接模式用于系统的初步设计，对于存在两个 独立变化维度的类可以将其分为抽象化和实现化两个角色，使它们可以分别进行变化；而在 初步设计完成之后，当发现系统与已有类无法协同工作时，可以采用适配器模式。但有时候 在设计初期也需要考虑适配器模式，特别是那些涉及到大量第三方应用接口的情况。</p>
</li>
<li><p>优点</p>
<ol>
<li><strong>分离抽象接口及其实现部分</strong>。桥接模式使用“对象间的关联关系”解耦了抽象和实现之间固 有的绑定关系，使得抽象和实现可以沿着各自的维度来变化。所谓抽象和实现沿着各自维度 的变化，也就是说抽象和实现不再在同一个继承层次结构中，而是“子类化”它们，使它们各自 都具有自己的子类，以便任何组合子类，从而获得多维度组合对象。</li>
<li>在很多情况下，<strong>桥接模式可以取代多层继承方案</strong>，多层继承方案违背了“单一职责原则”， 复用性较差，且类的个数非常多，桥接模式是比多层继承方案更好的解决方法，它极大减少 了子类的个数。</li>
<li>桥接模式提高了系统的可扩展性，在两个变化维度中任意扩展一个维度，都不需要修改原 有系统，符合“开闭原则”。</li>
</ol>
</li>
<li><p>缺点</p>
<ol>
<li>桥接模式的使用会增加系统的理解与设计难度，由于关联关系建立在抽象层，<strong>要求开发者 一开始就针对抽象层进行设计与编程。</strong></li>
<li>桥接模式<strong>要求正确识别出系统中两个独立变化的维度</strong>，因此其使用范围具有一定的局限 性，如何正确识别两个独立维度也需要一定的经验积累。</li>
</ol>
</li>
<li><p>注意事项</p>
<ol>
<li>如果一个系统需要在抽象化和具体化之间增加更多的灵活性，避免在两个层次之间建立静 态的继承关系，通过桥接模式可以使它们在抽象层建立一个关联关系。</li>
<li>“抽象部分”和“实现部分”可以以继承的方式独立扩展而互不影响，在程序运行时可以动态 将一个抽象化子类的对象和一个实现化子类的对象进行组合，即系统需要对抽象化角色和实 现化角色进行动态耦合。</li>
<li>一个类存在两个（或多个）独立变化的维度，且这两个（或多个）维度都需要独立进行扩 展。</li>
<li>对于那些不希望使用继承或因为多层继承导致系统类的个数急剧增加的系统，桥接模式尤为适用。</li>
</ol>
</li>
</ul>
<p>   练习：Sunny软件公司欲开发一个数据转换工具，可以将数据库中的数据转换成多种文件格式， 例如txt、xml、pdf等格式，同时该工具需要支持多种不同的数据库。试使用桥接模式对其进行设计。</p>
<p>​        分析：将文件格式作为转换工具的抽象部分，将数据库作为实体部分</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">FileType</span> <span class="token punctuation">{</span>
    <span class="token keyword">protected</span> DataBaseImp dbImp<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setDbImp</span><span class="token punctuation">(</span>DataBaseImp dbImp<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>dbImp <span class="token operator">=</span> dbImp<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">dataConversion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TxtFile</span> <span class="token keyword">extends</span> <span class="token class-name">FileType</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">dataConversion</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// TODO Auto-generated method stub</span>
        dbImp<span class="token punctuation">.</span><span class="token function">connectionDB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"将数据转换成txt文件"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">XMLFile</span> <span class="token keyword">extends</span> <span class="token class-name">FileType</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">dataConversion</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// TODO Auto-generated method stub</span>
        dbImp<span class="token punctuation">.</span><span class="token function">connectionDB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"将数据转换成xml文件"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PdfFile</span> <span class="token keyword">extends</span> <span class="token class-name">FileType</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">dataConversion</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// TODO Auto-generated method stub</span>
        dbImp<span class="token punctuation">.</span><span class="token function">connectionDB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"将数据转换成pdf文件"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">DataBaseImp</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">connectionDB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SQL</span> <span class="token keyword">implements</span> <span class="token class-name">DataBaseImp</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">connectionDB</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// TODO Auto-generated method stub</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"连接SQL数据库！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SqLite</span> <span class="token keyword">implements</span> <span class="token class-name">DataBaseImp</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">connectionDB</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// TODO Auto-generated method stub</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"连接Sqlite数据库！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MySql</span> <span class="token keyword">implements</span> <span class="token class-name">DataBaseImp</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">connectionDB</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// TODO Auto-generated method stub</span>

        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"连接Mysql数据库！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// TODO Auto-generated method stub</span>
        FileType file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        DataBaseImp dataBaseImp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqLite</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        file<span class="token punctuation">.</span><span class="token function">setDbImp</span><span class="token punctuation">(</span>dataBaseImp<span class="token punctuation">)</span><span class="token punctuation">;</span>
        file<span class="token punctuation">.</span><span class="token function">dataConversion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//输出结果</span>
连接Sqlite数据库！
将数据转换成xml文件</code></pre>
<p>练习：将毛笔与颜色的案例用桥接模式编码实现</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Brush</span> <span class="token punctuation">{</span>
    <span class="token keyword">protected</span> Color color<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setColor</span><span class="token punctuation">(</span>Color color<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>color <span class="token operator">=</span> color<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MaxBrush</span> <span class="token keyword">extends</span> <span class="token class-name">Brush</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// TODO Auto-generated method stub</span>
        color<span class="token punctuation">.</span><span class="token function">changeColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"选用大号毛笔作画！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StandardBrush</span> <span class="token keyword">extends</span> <span class="token class-name">Brush</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// TODO Auto-generated method stub</span>
        color<span class="token punctuation">.</span><span class="token function">changeColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"选用标准号毛笔作画！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MinBrush</span> <span class="token keyword">extends</span> <span class="token class-name">Brush</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// TODO Auto-generated method stub</span>
        color<span class="token punctuation">.</span><span class="token function">changeColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"选用小号毛笔作画！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Color</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">changeColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BlueColor</span> <span class="token keyword">implements</span> <span class="token class-name">Color</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">changeColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// TODO Auto-generated method stub</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"颜料为蓝色！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">YellowColor</span> <span class="token keyword">implements</span> <span class="token class-name">Color</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">changeColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// TODO Auto-generated method stub</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"颜料为黄色！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedColor</span> <span class="token keyword">implements</span> <span class="token class-name">Color</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">changeColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// TODO Auto-generated method stub</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"颜料为红色！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">XMLUtil</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> Object <span class="token function">getBean</span><span class="token punctuation">(</span>String args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            DocumentBuilderFactory dFactory <span class="token operator">=</span> DocumentBuilderFactory<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            DocumentBuilder dBuilder <span class="token operator">=</span> dFactory<span class="token punctuation">.</span><span class="token function">newDocumentBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            Document document <span class="token operator">=</span> dBuilder<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">"src//paintBrush//config.xml"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            NodeList nList <span class="token operator">=</span> null<span class="token punctuation">;</span>
            Node cNode <span class="token operator">=</span> null<span class="token punctuation">;</span>
            String cName <span class="token operator">=</span> null<span class="token punctuation">;</span>
            nList <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">"className"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"brush"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                cNode <span class="token operator">=</span> nList<span class="token punctuation">.</span><span class="token function">item</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFirstChild</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"color"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                cNode <span class="token operator">=</span> nList<span class="token punctuation">.</span><span class="token function">item</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFirstChild</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            cName <span class="token operator">=</span> cNode<span class="token punctuation">.</span><span class="token function">getNodeValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            Class <span class="token class-name">class1</span> <span class="token operator">=</span> Class<span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>cName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            Object object <span class="token operator">=</span> class1<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> object<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// TODO: handle exception</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> null<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<pre class=" language-xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>config</span><span class="token punctuation">></span></span>        
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>className</span><span class="token punctuation">></span></span>paintBrush.StandardBrush<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>className</span><span class="token punctuation">></span></span>        
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>className</span><span class="token punctuation">></span></span>paintBrush.RedColor<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>className</span><span class="token punctuation">></span></span>    
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>config</span><span class="token punctuation">></span></span>
</code></pre>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// TODO Auto-generated method stub</span>
        Brush brush <span class="token operator">=</span> <span class="token punctuation">(</span>Brush<span class="token punctuation">)</span> XMLUtil<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"brush"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Color color <span class="token operator">=</span> <span class="token punctuation">(</span>Color<span class="token punctuation">)</span> XMLUtil<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"color"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        brush<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span>color<span class="token punctuation">)</span><span class="token punctuation">;</span>
        brush<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment" spellcheck="true">//输出结果</span>
颜料为红色！
选用标准号毛笔作画！</code></pre>
<h3 id="组合模式"><a href="#组合模式" class="headerlink" title="组合模式"></a>组合模式</h3>
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="http://shapefire.github.io" rel="external nofollow noreferrer">ShapeFire</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="http://shapefire.github.io/posts/911124684/">http://shapefire.github.io/posts/911124684/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="http://shapefire.github.io" target="_blank">ShapeFire</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">
                                    <span class="chip bg-color">设计模式</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">

<div id="article-share">
    
    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
        </div>
    </div>

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/posts/1821512031/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/19.jpg" class="responsive-img" alt="Spring">
                        
                        <span class="card-title">Spring</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            Spring书籍——《Spring实战 第四版》
IOC(inversion of control):  对象有Spring容器创建，对象属性是Spring容器来设置
控制的内容：指谁来控制对象的创建；传统的应用程序是由程序本身控制，使用S
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2020-04-02
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/SSM/" class="post-category">
                                    SSM
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Spring/">
                        <span class="chip bg-color">Spring</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/posts/3710971821/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/12.jpg" class="responsive-img" alt="Kaptcha框架验证码实现">
                        
                        <span class="card-title">Kaptcha框架验证码实现</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            Kaptcha框架验证码实现​    工作原理：调用 com.google.code.kaptcha.servlet.KaptchaServlet,生成一张图片，同时将生成的验证码字符放在 HttpSession中，直接从session中获
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2020-02-15
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E9%AA%8C%E8%AF%81%E7%A0%81/" class="post-category">
                                    验证码
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E9%AA%8C%E8%AF%81%E7%A0%81/">
                        <span class="chip bg-color">验证码</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('250')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'PRE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + '来源: ShapeFanBlog<br />'
            + '文章作者: ShapeFan<br />'
            + '文章链接: <a href="' + url + '">' + url + '</a><br />'
            + '本文章著作权归作者所有，任何形式的转载都请注明出处。--ShapeFan';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () {bodyElement.removeChild(newdiv);}, 200);
    });
</script>


<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


<!-- 代码块折行 -->

<style type="text/css">
code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }
</style>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>



    <footer class="page-footer bg-color">
    <div class="container row center-align" style="margin-bottom: 15px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            <span id="year">2020</span>
            <a href="http://shapefire.github.io" target="_blank">ShapeFan</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/shapefire" target="_blank">ShapeFan</a>
            <br>
            
            &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                class="white-color">81.8k</span>&nbsp;字
            
            
            
            
            
            
              <span id="busuanzi_container_site_pv" style='display:none'></span>
                  <i class="fa fa-heart-o"></i>
                      本站总访问量 <span id="busuanzi_value_site_pv" class="white-color"></span>
             

            
                 <span id="busuanzi_container_site_uv" style='display:none'></span>
            人次,&nbsp;访客数 <span id="busuanzi_value_site_uv" class="white-color"></span> 人.
            

            <br>
            
            <span id="sitetime">载入运行时间...</span>
            <script>
                function siteTime() {
                    var seconds = 1000;
                    var minutes = seconds * 60;
                    var hours = minutes * 60;
                    var days = hours * 24;
                    var years = days * 365;
                    var today = new Date();
                    var startYear = "2020";
                    var startMonth = "2";
                    var startDate = "2";
                    var startHour = "16";
                    var startMinute = "0";
                    var startSecond = "0";
                    var todayYear = today.getFullYear();
                    var todayMonth = today.getMonth() + 1;
                    var todayDate = today.getDate();
                    var todayHour = today.getHours();
                    var todayMinute = today.getMinutes();
                    var todaySecond = today.getSeconds();
                    var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                    var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                    var diff = t2 - t1;
                    var diffYears = Math.floor(diff / years);
                    var diffDays = Math.floor((diff / days) - diffYears * 365);
                    var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
                    var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) /
                        minutes);
                    var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours -
                        diffMinutes * minutes) / seconds);
                    if (startYear == todayYear) {
                        document.getElementById("year").innerHTML = todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffDays + " 天 " + diffHours +
                            " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    } else {
                        document.getElementById("year").innerHTML = startYear + " - " + todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffYears + " 年 " + diffDays +
                            " 天 " + diffHours + " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    }
                }
                setInterval(siteTime, 1000);
            </script>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/shapefire" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:1754929015@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1754929015" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1754929015" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>
<script>
    $(document).ready(function () {

        var int = setInterval(fixCount, 50);  // 50ms周期检测函数
        var pvcountOffset = 80000;  // 初始化首次数据
        var uvcountOffset = 20000;

        function fixCount() {
            if (document.getElementById("busuanzi_container_site_pv").style.display != "none") {
                $("#busuanzi_value_site_pv").html(parseInt($("#busuanzi_value_site_pv").html()) + pvcountOffset);
                clearInterval(int);
            }
            if ($("#busuanzi_container_site_pv").css("display") != "none") {
                $("#busuanzi_value_site_uv").html(parseInt($("#busuanzi_value_site_uv").html()) + uvcountOffset); // 加上初始数据
                clearInterval(int); // 停止检测
            }
        }
    });
</script>

  <script src='https://unpkg.com/mermaid@7.1.2/dist/mermaid.min.js'></script>
  <script>
    if (window.mermaid) {
      mermaid.initialize({theme: 'forest'});
    }
  </script>



    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("/" + "search.xml", 'searchInput', 'searchResult');
});
</script>
    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Global site tag (gtag.js) - Google Analytics -->


    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    
<!-- 背景雪花飘落特效-->
    
        <script type="text/javascript">
            //只在桌面版网页启用特效
            var windowWidth = $(window).width();
            if (windowWidth > 768) {
                document.write('<script type="text/javascript" src="/js/sakura.js"><\/script>');
            }
        </script>
    
</body>

</html>
